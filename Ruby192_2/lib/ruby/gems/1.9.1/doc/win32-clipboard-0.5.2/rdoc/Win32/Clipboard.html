<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Class: Win32::Clipboard</title>

	<link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

	<script src="../js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="../js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="class">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="../lib/win32/clipboard_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="lib/win32/clipboard.rb">lib/win32/clipboard.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			
			<div id="parent-class-section" class="section">
				<h3 class="section-header">Parent</h3>
				
				<p class="link">Object</p>
				
			</div>
			

			<!-- Namespace Contents -->
			
			<div id="namespace-list-section" class="section">
				<h3 class="section-header">Namespace</h3>
				<ul class="link-list">
					
					<li><span class="type">CLASS</span> <a href="Clipboard/Error.html">Win32::Clipboard::Error</a></li>
					
				</ul>
			</div>
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#method-c-close">::close</a></li>
					
					<li><a href="#method-c-data">::data</a></li>
					
					<li><a href="#method-c-empty">::empty</a></li>
					
					<li><a href="#method-c-format_available%3F">::format_available?</a></li>
					
					<li><a href="#method-c-format_name">::format_name</a></li>
					
					<li><a href="#method-c-formats">::formats</a></li>
					
					<li><a href="#method-c-get_file_list">::get_file_list</a></li>
					
					<li><a href="#method-c-get_image_data">::get_image_data</a></li>
					
					<li><a href="#method-c-get_metafile_data">::get_metafile_data</a></li>
					
					<li><a href="#method-c-notify_change">::notify_change</a></li>
					
					<li><a href="#method-c-num_formats">::num_formats</a></li>
					
					<li><a href="#method-c-open">::open</a></li>
					
					<li><a href="#method-c-register_format">::register_format</a></li>
					
					<li><a href="#method-c-set_data">::set_data</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
			<div id="includes-section" class="section">
				<h3 class="section-header">Included Modules</h3>
				<ul class="link-list">
				
				
					<li><span class="include">Windows::Clipboard</span></li>
				
				
				
					<li><span class="include">Windows::Memory</span></li>
				
				
				
					<li><span class="include">Windows::Error</span></li>
				
				
				
					<li><span class="include">Windows::Window::Classes</span></li>
				
				
				
					<li><span class="include">Windows::Window::Message</span></li>
				
				
				</ul>
			</div>
			
		</div>

		<div id="project-metadata">
			
			
			<div id="fileindex-section" class="section project-section">
				<h3 class="section-header">Files</h3>
				<ul>
				
					<li class="file"><a href="../CHANGES.html">CHANGES</a></li>
				
					<li class="file"><a href="../MANIFEST.html">MANIFEST</a></li>
				
					<li class="file"><a href="../README.html">README</a></li>
				
				</ul>
			</div>
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="../images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="../Win32.html">Win32</a></li>
				
					<li><a href="../Win32/Clipboard.html">Win32::Clipboard</a></li>
				
					<li><a href="../Win32/Clipboard/Error.html">Win32::Clipboard::Error</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="class">Win32::Clipboard</h1>

		<div id="description">
			<p>
The <a href="Clipboard.html">Clipboard</a> class encapsulates functions
that relate to the MS Windows clipboard.
</p>

		</div>

		<!-- Constants -->
		
		<div id="constants-list" class="section">
			<h3 class="section-header">Constants</h3>
			<dl>
			
				<dt><a name="VERSION">VERSION</a></dt>
				
				<dd class="description"><p>
The version of this library
</p></dd>
				
			
				<dt><a name="TEXT">TEXT</a></dt>
				
				<dd class="description"><p>
Text
</p></dd>
				
			
				<dt><a name="OEMTEXT">OEMTEXT</a></dt>
				
				<dd class="description"></dd>
				
			
				<dt><a name="UNICODETEXT">UNICODETEXT</a></dt>
				
				<dd class="description"></dd>
				
			
				<dt><a name="DIB">DIB</a></dt>
				
				<dd class="description"><p>
Images
</p></dd>
				
			
				<dt><a name="BITMAP">BITMAP</a></dt>
				
				<dd class="description"></dd>
				
			
				<dt><a name="ENHMETAFILE">ENHMETAFILE</a></dt>
				
				<dd class="description"><p>
Metafiles
</p></dd>
				
			
				<dt><a name="HDROP">HDROP</a></dt>
				
				<dd class="description"><p>
Files
</p></dd>
				
			
			</dl>
		</div>
		

		<!-- Attributes -->
		

		<!-- Methods -->
		
		<div id="public-class-method-details" class="method-section section">
			<h3 class="section-header">Public Class Methods</h3>

		
			<div id="data-method" class="method-detail ">
				<a name="method-c-data"></a>

				<div class="method-heading">
				
					<span class="method-name">data</span><span
						class="method-args">(format = TEXT)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns the data currently in the clipboard. If <tt>format</tt> is
specified, it will attempt to retrieve the data in that format. The
default is Clipboard::TEXT.
</p>
<p>
If there is no data in the clipboard, or data is available but the format
doesn&#8217;t match the data, then an empty string is returned.
</p>
<p>
Examples:
</p>
<pre>
   # Get some plain text
   Win32::Clipboard.data # =&gt; e.g. 'hello'

   # Get a list of files copied from the Windows Explorer window
   Win32::Clipboard.data(Clipboard::HDROP) # =&gt; ['foo.rb', 'bar.rb']

   # Get a bitmap and write it to another file
   File.open('bitmap_copy', 'wb'){ |fh|
      fh.write Win32::Clipboard.data(Clipboard::DIB)
   }
</pre>
<p>

</p>
					

					
					<div class="method-source-code"
						id="data-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 114</span>
114:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">data</span>(<span class="ruby-identifier">format</span> = <span class="ruby-constant">TEXT</span>)
115:          <span class="ruby-keyword kw">begin</span>
116:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>
117:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">IsClipboardFormatAvailable</span>(<span class="ruby-identifier">format</span>)
118:                <span class="ruby-identifier">handle</span> = <span class="ruby-constant">GetClipboardData</span>(<span class="ruby-identifier">format</span>)
119:                <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">format</span>
120:                   <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TEXT</span>, <span class="ruby-constant">OEMTEXT</span>, <span class="ruby-constant">UNICODETEXT</span>
121:                      <span class="ruby-identifier">clip_data</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-constant">GlobalSize</span>(<span class="ruby-identifier">handle</span>)
122:                      <span class="ruby-identifier">memcpy</span>(<span class="ruby-identifier">clip_data</span>, <span class="ruby-identifier">handle</span>, <span class="ruby-identifier">clip_data</span>.<span class="ruby-identifier">size</span>)
123:                      <span class="ruby-identifier">clip_data</span> = <span class="ruby-identifier">clip_data</span>[ <span class="ruby-regexp re">/^[^\00]]*/</span> ]
124:                   <span class="ruby-keyword kw">when</span> <span class="ruby-constant">HDROP</span>
125:                      <span class="ruby-identifier">clip_data</span> = <span class="ruby-identifier">get_file_list</span>(<span class="ruby-identifier">handle</span>)
126:                   <span class="ruby-keyword kw">when</span> <span class="ruby-constant">ENHMETAFILE</span>
127:                      <span class="ruby-identifier">clip_data</span> = <span class="ruby-identifier">get_metafile_data</span>(<span class="ruby-identifier">handle</span>)
128:                   <span class="ruby-keyword kw">when</span> <span class="ruby-constant">DIB</span>, <span class="ruby-constant">BITMAP</span>
129:                      <span class="ruby-identifier">clip_data</span> = <span class="ruby-identifier">get_image_data</span>(<span class="ruby-identifier">handle</span>)
130:                   <span class="ruby-keyword kw">else</span>
131:                      <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">'format not supported'</span>
132:                <span class="ruby-keyword kw">end</span>
133:             <span class="ruby-keyword kw">else</span>
134:                <span class="ruby-identifier">clip_data</span> = <span class="ruby-value str">''</span>
135:             <span class="ruby-keyword kw">end</span>
136:          <span class="ruby-keyword kw">ensure</span>
137:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">close</span>
138:          <span class="ruby-keyword kw">end</span>
139: 
140:          <span class="ruby-identifier">clip_data</span>
141:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="empty-method" class="method-detail ">
				<a name="method-c-empty"></a>

				<div class="method-heading">
				
					<span class="method-name">empty</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Empties the contents of the clipboard. 
</p>
					

					
					<div class="method-source-code"
						id="empty-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 145</span>
145:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">empty</span>
146:          <span class="ruby-keyword kw">begin</span>
147:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>
148:             <span class="ruby-constant">EmptyClipboard</span>()
149:          <span class="ruby-keyword kw">ensure</span>
150:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">close</span>
151:          <span class="ruby-keyword kw">end</span>
152: 
153:          <span class="ruby-keyword kw">self</span>
154:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="format-available--method" class="method-detail ">
				<a name="method-c-format_available%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">format_available?</span><span
						class="method-args">(format)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns whether or not <tt>format</tt> (an int) is currently available. 
</p>
					

					
					<div class="method-source-code"
						id="format-available--source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 181</span>
181:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">format_available?</span>(<span class="ruby-identifier">format</span>)
182:          <span class="ruby-constant">IsClipboardFormatAvailable</span>(<span class="ruby-identifier">format</span>)
183:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="format-name-method" class="method-detail ">
				<a name="method-c-format_name"></a>

				<div class="method-heading">
				
					<span class="method-name">format_name</span><span
						class="method-args">(format_num)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns the corresponding name for the given <tt>format_num</tt>, or nil
if it does not exist. You cannot specify any of the predefined clipboard
formats (or nil is returned), only registered formats. 
</p>
					

					
					<div class="method-source-code"
						id="format-name-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 189</span>
189:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">format_name</span>(<span class="ruby-identifier">format_num</span>)
190:          <span class="ruby-identifier">val</span> = <span class="ruby-keyword kw">nil</span>
191:          <span class="ruby-identifier">buf</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">80</span>
192: 
193:          <span class="ruby-keyword kw">begin</span>
194:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>
195:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">GetClipboardFormatName</span>(<span class="ruby-identifier">format_num</span>, <span class="ruby-identifier">buf</span>, <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">length</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
196:                <span class="ruby-identifier">val</span> = <span class="ruby-identifier">buf</span>
197:             <span class="ruby-keyword kw">end</span>
198:          <span class="ruby-keyword kw">ensure</span>
199:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">close</span>
200:          <span class="ruby-keyword kw">end</span>
201: 
202:          <span class="ruby-identifier">val</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span>).<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>
203:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="formats-method" class="method-detail ">
				<a name="method-c-formats"></a>

				<div class="method-heading">
				
					<span class="method-name">formats</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns a hash of all the current formats, with the format number as the
key and the format name as the value for that key.
</p>
<p>
Example:
</p>
<pre>
   Win32::Clipboard.formats # =&gt; {1 =&gt; nil, 49335 =&gt; &quot;HTML Format&quot;}
</pre>
<p>

</p>
					

					
					<div class="method-source-code"
						id="formats-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 212</span>
212:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">formats</span>
213:          <span class="ruby-identifier">formats</span> = {}
214:          <span class="ruby-identifier">format</span> = <span class="ruby-value">0</span>
215:          
216:          <span class="ruby-keyword kw">begin</span>
217:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>
218:             <span class="ruby-keyword kw">while</span> <span class="ruby-value">0</span> <span class="ruby-operator">!=</span> (<span class="ruby-identifier">format</span> = <span class="ruby-constant">EnumClipboardFormats</span>(<span class="ruby-identifier">format</span>))
219:                <span class="ruby-identifier">buf</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">80</span>
220:                <span class="ruby-constant">GetClipboardFormatName</span>(<span class="ruby-identifier">format</span>, <span class="ruby-identifier">buf</span>, <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">length</span>)
221:                <span class="ruby-identifier">formats</span>[<span class="ruby-identifier">format</span>] = <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span>).<span class="ruby-identifier">first</span>
222:             <span class="ruby-keyword kw">end</span>
223:          <span class="ruby-keyword kw">ensure</span>
224:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">close</span>
225:          <span class="ruby-keyword kw">end</span>
226: 
227:          <span class="ruby-identifier">formats</span>
228:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="notify-change-method" class="method-detail ">
				<a name="method-c-notify_change"></a>

				<div class="method-heading">
				
					<span class="method-name">notify_change</span><span
						class="method-args">(&block)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<pre>
 Sets up a notification loop that will call the provided block whenever
 there's a change to the clipboard.

 Example:

    Win32::Clipboard.notify_change{
       puts &quot;There's been a change in the clipboard contents!&quot;
    }
</pre>
<p>
&#8212;
</p>
<pre>
 We skip the first notification because the very act of attaching the
 new window causes it to trigger once.
</pre>
<p>

</p>
					

					
					<div class="method-source-code"
						id="notify-change-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 268</span>
268:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">notify_change</span>(&amp;<span class="ruby-identifier">block</span>)
269:          <span class="ruby-identifier">name</span>   = <span class="ruby-value str">'ruby-clipboard-'</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>
270:          <span class="ruby-identifier">handle</span> = <span class="ruby-constant">CreateWindow</span>(<span class="ruby-value str">'static'</span>, <span class="ruby-identifier">name</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>)
271:          
272:          <span class="ruby-ivar">@first_notify</span> = <span class="ruby-keyword kw">true</span>
273: 
274:          <span class="ruby-identifier">wnd_proc</span> = <span class="ruby-constant">Win32</span><span class="ruby-operator">::</span><span class="ruby-constant">API</span><span class="ruby-operator">::</span><span class="ruby-constant">Callback</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'LLLL'</span>, <span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">hwnd</span>, <span class="ruby-identifier">umsg</span>, <span class="ruby-identifier">wparam</span>, <span class="ruby-identifier">lparam</span><span class="ruby-operator">|</span>
275:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">umsg</span>
276:                <span class="ruby-keyword kw">when</span> <span class="ruby-constant">WM_DRAWCLIPBOARD</span>
277:                   <span class="ruby-keyword kw">yield</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@first_notify</span>
278:                   <span class="ruby-identifier">next_viewer</span> = <span class="ruby-constant">GetWindowLongPtr</span>(<span class="ruby-identifier">hwnd</span>, <span class="ruby-constant">GWL_USERDATA</span>)
279:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">next_viewer</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
280:                      <span class="ruby-constant">PostMessage</span>(<span class="ruby-identifier">next_viewer</span>, <span class="ruby-identifier">umsg</span>, <span class="ruby-identifier">wparam</span>, <span class="ruby-identifier">lparam</span>)
281:                   <span class="ruby-keyword kw">end</span>
282:                   <span class="ruby-identifier">rv</span> = <span class="ruby-value">0</span>
283:                <span class="ruby-keyword kw">when</span> <span class="ruby-constant">WM_CHANGECBCHAIN</span>
284:                   <span class="ruby-keyword kw">yield</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@first_notify</span>
285:                   <span class="ruby-identifier">next_viewer</span> = <span class="ruby-identifier">lparam</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">next_viewer</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">wparam</span>
286:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">next_viewer</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
287:                      <span class="ruby-constant">PostMessage</span>(<span class="ruby-identifier">next_viewer</span>, <span class="ruby-identifier">umsg</span>, <span class="ruby-identifier">wparam</span>, <span class="ruby-identifier">lparam</span>)
288:                   <span class="ruby-keyword kw">end</span>
289:                   <span class="ruby-identifier">rv</span> = <span class="ruby-value">0</span>
290:                <span class="ruby-keyword kw">else</span>
291:                   <span class="ruby-identifier">rv</span> = <span class="ruby-constant">DefWindowProc</span>(<span class="ruby-identifier">hwnd</span>, <span class="ruby-identifier">umsg</span>, <span class="ruby-identifier">wparam</span>, <span class="ruby-identifier">lparam</span>)
292:             <span class="ruby-keyword kw">end</span>
293:             
294:             <span class="ruby-ivar">@first_notify</span> = <span class="ruby-keyword kw">false</span>
295:          
296:             <span class="ruby-identifier">rv</span>
297:          <span class="ruby-keyword kw">end</span>
298: 
299:          <span class="ruby-identifier">old_wnd_proc</span> = <span class="ruby-constant">SetWindowLongPtr</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-constant">GWL_WNDPROC</span>, <span class="ruby-identifier">wnd_proc</span>.<span class="ruby-identifier">address</span>)
300:          <span class="ruby-identifier">next_viewer</span>  = <span class="ruby-constant">SetClipboardViewer</span>(<span class="ruby-identifier">handle</span>)
301: 
302:          <span class="ruby-constant">SetWindowLongPtr</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-constant">GWL_USERDATA</span>, <span class="ruby-identifier">next_viewer</span>)
303: 
304:          <span class="ruby-identifier">msg</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">100</span>
305: 
306:          <span class="ruby-keyword kw">while</span> <span class="ruby-keyword kw">true</span>
307:             <span class="ruby-keyword kw">while</span> <span class="ruby-constant">PeekMessage</span>(<span class="ruby-identifier">msg</span>, <span class="ruby-identifier">handle</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">1</span>)
308:                <span class="ruby-constant">TranslateMessage</span>(<span class="ruby-identifier">msg</span>)
309:                <span class="ruby-constant">DispatchMessage</span>(<span class="ruby-identifier">msg</span>)
310:             <span class="ruby-keyword kw">end</span>
311:             <span class="ruby-identifier">sleep</span> <span class="ruby-value">0.1</span>
312:          <span class="ruby-keyword kw">end</span>
313:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="num-formats-method" class="method-detail ">
				<a name="method-c-num_formats"></a>

				<div class="method-heading">
				
					<span class="method-name">num_formats</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns the number of different data formats currently on the clipboard.

</p>
					

					
					<div class="method-source-code"
						id="num-formats-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 166</span>
166:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">num_formats</span>
167:          <span class="ruby-identifier">count</span> = <span class="ruby-value">0</span>
168: 
169:          <span class="ruby-keyword kw">begin</span>
170:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>
171:             <span class="ruby-identifier">count</span> = <span class="ruby-constant">CountClipboardFormats</span>()
172:          <span class="ruby-keyword kw">ensure</span>
173:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">close</span>
174:          <span class="ruby-keyword kw">end</span>
175: 
176:          <span class="ruby-identifier">count</span>
177:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="register-format-method" class="method-detail ">
				<a name="method-c-register_format"></a>

				<div class="method-heading">
				
					<span class="method-name">register_format</span><span
						class="method-args">(format)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Registers the given <tt>format</tt> (a String) as a clipboard format,
which can then be used as a valid clipboard format. Returns the integer
value of the registered format.
</p>
<p>
If a registered format with the specified name already exists, a new
format is not registered and the return value identifies the existing
format. This enables more than one application to copy and paste data
using the same registered clipboard format. Note that the format name
comparison is case-insensitive.
</p>
<p>
Registered clipboard formats are identified by values in the range 0xC000
through 0xFFFF. 
</p>
					

					
					<div class="method-source-code"
						id="register-format-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 243</span>
243:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">register_format</span>(<span class="ruby-identifier">format</span>)
244:          <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">format</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
245:          
246:          <span class="ruby-identifier">format_value</span> = <span class="ruby-constant">RegisterClipboardFormat</span>(<span class="ruby-identifier">format</span>)
247:          
248:          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">format_value</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
249:             <span class="ruby-identifier">error</span> = <span class="ruby-value str">&quot;RegisterClipboardFormat() call failed: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">get_last_error</span>
250:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">error</span>
251:          <span class="ruby-keyword kw">end</span>
252:          
253:          <span class="ruby-identifier">format_value</span>
254:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="set-data-method" class="method-detail ">
				<a name="method-c-set_data"></a>

				<div class="method-heading">
				
					<span class="method-name">set_data</span><span
						class="method-args">(clip_data, format = TEXT)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Sets the clipboard contents to the data that you specify. You may
optionally specify a clipboard format. The default is Clipboard::TEXT.
</p>
<p>
Example:
</p>
<pre>
   # Put the string 'hello' on the clipboard
   Win32::Clipboard.set_data('hello')
</pre>
<p>

</p>
					

					
					<div class="method-source-code"
						id="set-data-source">
<pre>
    <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 66</span>
66:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">set_data</span>(<span class="ruby-identifier">clip_data</span>, <span class="ruby-identifier">format</span> = <span class="ruby-constant">TEXT</span>)
67:          <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>
68:          <span class="ruby-constant">EmptyClipboard</span>()
69: 
70:          <span class="ruby-comment cmt"># NULL terminate text</span>
71:          <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">format</span>
72:             <span class="ruby-keyword kw">when</span> <span class="ruby-constant">TEXT</span>, <span class="ruby-constant">OEMTEXT</span>, <span class="ruby-constant">UNICODETEXT</span>                             
73:                <span class="ruby-identifier">clip_data</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\00&quot;&quot;</span>
74:          <span class="ruby-keyword kw">end</span>
75: 
76:          <span class="ruby-comment cmt"># Global Allocate a movable piece of memory.</span>
77:          <span class="ruby-identifier">hmem</span> = <span class="ruby-constant">GlobalAlloc</span>(<span class="ruby-constant">GHND</span>, <span class="ruby-identifier">clip_data</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-value">4</span>)
78:          <span class="ruby-identifier">mem</span>  = <span class="ruby-constant">GlobalLock</span>(<span class="ruby-identifier">hmem</span>)
79:          <span class="ruby-identifier">memcpy</span>(<span class="ruby-identifier">mem</span>, <span class="ruby-identifier">clip_data</span>, <span class="ruby-identifier">clip_data</span>.<span class="ruby-identifier">length</span>)
80: 
81:          <span class="ruby-comment cmt"># Set the new data</span>
82:          <span class="ruby-keyword kw">begin</span>
83:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">SetClipboardData</span>(<span class="ruby-identifier">format</span>, <span class="ruby-identifier">hmem</span>) <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
84:                <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;SetClipboardData() failed: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">get_last_error</span>
85:             <span class="ruby-keyword kw">end</span>
86:          <span class="ruby-keyword kw">ensure</span>
87:             <span class="ruby-constant">GlobalFree</span>(<span class="ruby-identifier">hmem</span>)
88:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">close</span>
89:          <span class="ruby-keyword kw">end</span>
90: 
91:          <span class="ruby-keyword kw">self</span>
92:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="private-class-method-details" class="method-section section">
			<h3 class="section-header">Private Class Methods</h3>

		
			<div id="close-method" class="method-detail ">
				<a name="method-c-close"></a>

				<div class="method-heading">
				
					<span class="method-name">close</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Close the clipboard 
</p>
					

					
					<div class="method-source-code"
						id="close-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 328</span>
328:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">close</span>
329:          <span class="ruby-constant">CloseClipboard</span>()
330:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="get-file-list-method" class="method-detail ">
				<a name="method-c-get_file_list"></a>

				<div class="method-heading">
				
					<span class="method-name">get_file_list</span><span
						class="method-args">(handle)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Get and return an array of file names that have been copied. 
</p>
					

					
					<div class="method-source-code"
						id="get-file-list-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 398</span>
398:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_file_list</span>(<span class="ruby-identifier">handle</span>)
399:          <span class="ruby-identifier">array</span> = []
400:          <span class="ruby-identifier">count</span> = <span class="ruby-constant">DragQueryFile</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-value">0xFFFFFFFF</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>)
401: 
402:          <span class="ruby-value">0</span>.<span class="ruby-identifier">upto</span>(<span class="ruby-identifier">count</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>){ <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
403:             <span class="ruby-identifier">length</span> = <span class="ruby-constant">DragQueryFile</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">i</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">0</span>) <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
404:             <span class="ruby-identifier">buf</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-identifier">length</span>
405:             <span class="ruby-constant">DragQueryFile</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">i</span>, <span class="ruby-identifier">buf</span>, <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">length</span>)
406:             <span class="ruby-identifier">array</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">strip</span>
407:          }
408: 
409:          <span class="ruby-identifier">array</span>
410:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="get-image-data-method" class="method-detail ">
				<a name="method-c-get_image_data"></a>

				<div class="method-heading">
				
					<span class="method-name">get_image_data</span><span
						class="method-args">(handle)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Get data for bitmap files 
</p>
					

					
					<div class="method-source-code"
						id="get-image-data-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 343</span>
343:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_image_data</span>(<span class="ruby-identifier">handle</span>)       
344:          <span class="ruby-identifier">buf</span> = <span class="ruby-keyword kw">nil</span>
345:          <span class="ruby-identifier">bmi</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">44</span> <span class="ruby-comment cmt"># BITMAPINFO</span>
346: 
347:          <span class="ruby-keyword kw">begin</span>
348:             <span class="ruby-identifier">address</span>  = <span class="ruby-constant">GlobalLock</span>(<span class="ruby-identifier">handle</span>)
349:             <span class="ruby-identifier">buf_size</span> = <span class="ruby-constant">GlobalSize</span>(<span class="ruby-identifier">handle</span>)
350: 
351:             <span class="ruby-identifier">memcpy</span>(<span class="ruby-identifier">bmi</span>, <span class="ruby-identifier">address</span>, <span class="ruby-identifier">bmi</span>.<span class="ruby-identifier">length</span>)
352: 
353:             <span class="ruby-identifier">size</span>        = <span class="ruby-identifier">bmi</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>  <span class="ruby-comment cmt"># biSize</span>
354:             <span class="ruby-identifier">bit_count</span>   = <span class="ruby-identifier">bmi</span>[<span class="ruby-value">14</span>,<span class="ruby-value">2</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'S'</span>).<span class="ruby-identifier">first</span> <span class="ruby-comment cmt"># biBitCount</span>
355:             <span class="ruby-identifier">compression</span> = <span class="ruby-identifier">bmi</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span> <span class="ruby-comment cmt"># biCompression</span>
356:             <span class="ruby-identifier">size_image</span>  = <span class="ruby-identifier">bmi</span>[<span class="ruby-value">20</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span> <span class="ruby-comment cmt"># biSizeImage</span>
357:             <span class="ruby-identifier">clr_used</span>    = <span class="ruby-identifier">bmi</span>[<span class="ruby-value">32</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span> <span class="ruby-comment cmt"># biClrUsed</span>
358: 
359:             <span class="ruby-identifier">size_image</span> = <span class="ruby-identifier">buf_size</span> <span class="ruby-operator">+</span> <span class="ruby-value">16</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">size_image</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
360: 
361:             <span class="ruby-comment cmt"># Calculate the header size</span>
362:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">bit_count</span>
363:                <span class="ruby-keyword kw">when</span> <span class="ruby-value">1</span>
364:                   <span class="ruby-identifier">table_size</span> = <span class="ruby-value">2</span>
365:                <span class="ruby-keyword kw">when</span> <span class="ruby-value">4</span>
366:                   <span class="ruby-identifier">table_size</span> = <span class="ruby-value">16</span>
367:                <span class="ruby-keyword kw">when</span> <span class="ruby-value">8</span>
368:                   <span class="ruby-identifier">table_size</span> = <span class="ruby-value">256</span>
369:                <span class="ruby-keyword kw">when</span> <span class="ruby-value">16</span>, <span class="ruby-value">32</span>
370:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">compression</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
371:                      <span class="ruby-identifier">table_size</span> = <span class="ruby-identifier">clr_used</span>
372:                   <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">compression</span> <span class="ruby-operator">==</span> <span class="ruby-value">3</span>
373:                      <span class="ruby-identifier">table_size</span> = <span class="ruby-value">3</span>
374:                   <span class="ruby-keyword kw">else</span>
375:                      <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;invalid bit/compression combination&quot;</span>
376:                   <span class="ruby-keyword kw">end</span>
377:                <span class="ruby-keyword kw">when</span> <span class="ruby-value">24</span>
378:                   <span class="ruby-identifier">table_size</span> = <span class="ruby-identifier">clr_used</span>
379:                <span class="ruby-keyword kw">else</span>
380:                   <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;invalid bit count&quot;</span>
381:             <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># case</span>
382: 
383:             <span class="ruby-identifier">offset</span> = <span class="ruby-value">0x36</span> <span class="ruby-operator">+</span> (<span class="ruby-identifier">table_size</span> * <span class="ruby-value">4</span>)
384:             <span class="ruby-identifier">buf</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-identifier">buf_size</span>
385: 
386:             <span class="ruby-identifier">memcpy</span>(<span class="ruby-identifier">buf</span>, <span class="ruby-identifier">address</span>, <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">size</span>)
387: 
388:             <span class="ruby-identifier">buf</span> = <span class="ruby-value str">&quot;\x42\x4D&quot;</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">size_image</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-operator">+</span> <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">offset</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">buf</span>
389:          <span class="ruby-keyword kw">ensure</span>
390:             <span class="ruby-constant">GlobalUnlock</span>(<span class="ruby-identifier">handle</span>)
391:          <span class="ruby-keyword kw">end</span>
392: 
393:          <span class="ruby-identifier">buf</span>
394:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="get-metafile-data-method" class="method-detail ">
				<a name="method-c-get_metafile_data"></a>

				<div class="method-heading">
				
					<span class="method-name">get_metafile_data</span><span
						class="method-args">(handle)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Get data for enhanced metadata files 
</p>
					

					
					<div class="method-source-code"
						id="get-metafile-data-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 334</span>
334:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">get_metafile_data</span>(<span class="ruby-identifier">handle</span>)
335:          <span class="ruby-identifier">buf_size</span> = <span class="ruby-constant">GetEnhMetaFileBits</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-value">0</span>, <span class="ruby-keyword kw">nil</span>)
336:          <span class="ruby-identifier">buf</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-identifier">buf_size</span>
337:          <span class="ruby-constant">GetEnhMetaFileBits</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">buf_size</span>, <span class="ruby-identifier">buf</span>)
338:          <span class="ruby-identifier">buf</span>
339:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="open-method" class="method-detail ">
				<a name="method-c-open"></a>

				<div class="method-heading">
				
					<span class="method-name">open</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Opens the clipboard and prevents other applications from modifying the
clipboard content until it is closed. 
</p>
					

					
					<div class="method-source-code"
						id="open-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/clipboard.rb, line 320</span>
320:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">open</span>
321:          <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-constant">OpenClipboard</span>(<span class="ruby-keyword kw">nil</span>)
322:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;OpenClipboard() failed: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">get_last_error</span>
323:          <span class="ruby-keyword kw">end</span>
324:       <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

