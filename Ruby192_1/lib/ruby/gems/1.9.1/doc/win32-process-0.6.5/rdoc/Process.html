<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

	<title>Module: Process</title>

	<link rel="stylesheet" href="./rdoc.css" type="text/css" media="screen" />

	<script src="./js/jquery.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/thickbox-compressed.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/quicksearch.js" type="text/javascript"
		charset="utf-8"></script>
	<script src="./js/darkfish.js" type="text/javascript"
		charset="utf-8"></script>

</head>
<body class="module">

	<div id="metadata">
		<div id="home-metadata">
			<div id="home-section" class="section">
        <h3 class="section-header">
          <a href="./index.html">Home</a>
          <a href="./index.html#classes">Classes</a>
          <a href="./index.html#methods">Methods</a>
        </h3>
			</div>
		</div>

		<div id="file-metadata">
			<div id="file-list-section" class="section">
				<h3 class="section-header">In Files</h3>
				<div class="section-body">
					<ul>
					
						<li><a href="./lib/win32/process_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
							class="thickbox" title="lib/win32/process.rb">lib/win32/process.rb</a></li>
					
					</ul>
				</div>
			</div>

			
		</div>

		<div id="class-metadata">

			<!-- Parent Class -->
			

			<!-- Namespace Contents -->
			
			<div id="namespace-list-section" class="section">
				<h3 class="section-header">Namespace</h3>
				<ul class="link-list">
					
					<li><span class="type">CLASS</span> <a href="Process/Error.html">Process::Error</a></li>
					
				</ul>
			</div>
			

			<!-- Method Quickref -->
			
			<div id="method-list-section" class="section">
				<h3 class="section-header">Methods</h3>
				<ul class="link-list">
					
					<li><a href="#method-c-create">::create</a></li>
					
					<li><a href="#method-c-fork">::fork</a></li>
					
					<li><a href="#method-c-get_affinity">::get_affinity</a></li>
					
					<li><a href="#method-c-getpriority">::getpriority</a></li>
					
					<li><a href="#method-c-getrlimit">::getrlimit</a></li>
					
					<li><a href="#method-c-job%3F">::job?</a></li>
					
					<li><a href="#method-c-kill">::kill</a></li>
					
					<li><a href="#method-c-ppid">::ppid</a></li>
					
					<li><a href="#method-c-setpriority">::setpriority</a></li>
					
					<li><a href="#method-c-setrlimit">::setrlimit</a></li>
					
					<li><a href="#method-c-uid">::uid</a></li>
					
					<li><a href="#method-c-wait">::wait</a></li>
					
					<li><a href="#method-c-wait2">::wait2</a></li>
					
					<li><a href="#method-c-waitpid">::waitpid</a></li>
					
					<li><a href="#method-c-waitpid2">::waitpid2</a></li>
					
					<li><a href="#method-i-create">#create</a></li>
					
					<li><a href="#method-i-fork">#fork</a></li>
					
					<li><a href="#method-i-get_affinity">#get_affinity</a></li>
					
					<li><a href="#method-i-getpriority">#getpriority</a></li>
					
					<li><a href="#method-i-getrlimit">#getrlimit</a></li>
					
					<li><a href="#method-i-job%3F">#job?</a></li>
					
					<li><a href="#method-i-kill">#kill</a></li>
					
					<li><a href="#method-i-ppid">#ppid</a></li>
					
					<li><a href="#method-i-setpriority">#setpriority</a></li>
					
					<li><a href="#method-i-setrlimit">#setrlimit</a></li>
					
					<li><a href="#method-i-uid">#uid</a></li>
					
					<li><a href="#method-i-wait">#wait</a></li>
					
					<li><a href="#method-i-wait2">#wait2</a></li>
					
					<li><a href="#method-i-waitpid">#waitpid</a></li>
					
					<li><a href="#method-i-waitpid2">#waitpid2</a></li>
					
				</ul>
			</div>
			

			<!-- Included Modules -->
			
			<div id="includes-section" class="section">
				<h3 class="section-header">Included Modules</h3>
				<ul class="link-list">
				
				
					<li><span class="include">Windows::Process</span></li>
				
				
				
					<li><span class="include">Windows::Thread</span></li>
				
				
				
					<li><span class="include">Windows::Error</span></li>
				
				
				
					<li><span class="include">Windows::Library</span></li>
				
				
				
					<li><span class="include">Windows::Console</span></li>
				
				
				
					<li><span class="include">Windows::Handle</span></li>
				
				
				
					<li><span class="include">Windows::Security</span></li>
				
				
				
					<li><span class="include">Windows::Synchronize</span></li>
				
				
				
					<li><span class="include">Windows::Window</span></li>
				
				
				
					<li><span class="include">Windows::Unicode</span></li>
				
				
				
					<li><span class="include">Windows::ToolHelper</span></li>
				
				
				
					<li><span class="include">Windows::MSVCRT::String</span></li>
				
				
				</ul>
			</div>
			
		</div>

		<div id="project-metadata">
			
			
			<div id="fileindex-section" class="section project-section">
				<h3 class="section-header">Files</h3>
				<ul>
				
					<li class="file"><a href="./CHANGES.html">CHANGES</a></li>
				
					<li class="file"><a href="./MANIFEST.html">MANIFEST</a></li>
				
					<li class="file"><a href="./README.html">README</a></li>
				
				</ul>
			</div>
			

			<div id="classindex-section" class="section project-section">
				<h3 class="section-header">Class Index
					<span class="search-toggle"><img src="./images/find.png"
						height="16" width="16" alt="[+]"
						title="show/hide quicksearch" /></span></h3>
				<form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
				<fieldset>
					<legend>Quicksearch</legend>
					<input type="text" name="quicksearch" value=""
						class="quicksearch-field" />
				</fieldset>
				</form>

				<ul class="link-list">
				
					<li><a href="./Process.html">Process</a></li>
				
					<li><a href="./Process/Error.html">Process::Error</a></li>
				
					<li><a href="./Kernel.html">Kernel</a></li>
				
				</ul>
				<div id="no-class-search-results" style="display: none;">No matching classes.</div>
			</div>

			
		</div>
	</div>

	<div id="documentation">
		<h1 class="module">Process</h1>

		<div id="description">
			
		</div>

		<!-- Constants -->
		
		<div id="constants-list" class="section">
			<h3 class="section-header">Constants</h3>
			<dl>
			
				<dt><a name="WIN32_PROCESS_VERSION">WIN32_PROCESS_VERSION</a></dt>
				
				<dd class="description"><p>
The version of the win32-process library
</p></dd>
				
			
				<dt><a name="PRIO_PROCESS">PRIO_PROCESS</a></dt>
				
				<dd class="description"><p>
Defined for interface compatibility, but not used
</p></dd>
				
			
				<dt><a name="PRIO_PGRP">PRIO_PGRP</a></dt>
				
				<dd class="description"></dd>
				
			
				<dt><a name="PRIO_USER">PRIO_USER</a></dt>
				
				<dd class="description"></dd>
				
			
			</dl>
		</div>
		

		<!-- Attributes -->
		

		<!-- Methods -->
		
		<div id="public-class-method-details" class="method-section section">
			<h3 class="section-header">Public Class Methods</h3>

		
			<div id="create-method" class="method-detail ">
				<a name="method-c-create"></a>

				<div class="method-heading">
				
					<span class="method-name">create</span><span
						class="method-args">(args)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
<a href="Process.html#method-i-create">Process.create</a>(key => value,
&#8230;) => ProcessInfo
</p>
<p>
This is a wrapper for the CreateProcess() function. It executes a process,
returning a ProcessInfo struct. It accepts a hash as an argument. There are
several primary keys:
</p>
<ul>
<li><p>
command_line     (mandatory)
</p>
</li>
<li><p>
app_name         (default: nil)
</p>
</li>
<li><p>
inherit          (default: false)
</p>
</li>
<li><p>
process_inherit  (default: false)
</p>
</li>
<li><p>
thread_inherit   (default: false)
</p>
</li>
<li><p>
creation_flags   (default: 0)
</p>
</li>
<li><p>
cwd              (default: Dir.pwd)
</p>
</li>
<li><p>
startup_info     (default: nil)
</p>
</li>
<li><p>
environment      (default: nil)
</p>
</li>
<li><p>
close_handles    (default: true)
</p>
</li>
<li><p>
with_logon       (default: nil)
</p>
</li>
<li><p>
domain           (default: nil)
</p>
</li>
<li><p>
password         (default: nil)
</p>
</li>
</ul>
<p>
Of these, the &#8216;command_line&#8217; or &#8216;app_name&#8217; must be
specified or an error is raised. Both may be set individually, but
&#8216;command_line&#8217; should be preferred if only one of them is set
because it does not (necessarily) require an explicit path or extension to
work.
</p>
<p>
The &#8216;domain&#8217; and &#8216;password&#8217; options are only
relevent in the context of &#8216;with_logon&#8217;.
</p>
<p>
The startup_info key takes a hash. Its keys are attributes that are part of
the StartupInfo struct, and are generally only meaningful for GUI or
console processes. See the documentation on CreateProcess() and the
StartupInfo struct on MSDN for more information.
</p>
<pre>
     
</pre>
<ul>
<li><p>
desktop
</p>
</li>
<li><p>
title
</p>
</li>
<li><p>
x
</p>
</li>
<li><p>
y
</p>
</li>
<li><p>
x_size
</p>
</li>
<li><p>
y_size
</p>
</li>
<li><p>
x_count_chars
</p>
</li>
<li><p>
y_count_chars
</p>
</li>
<li><p>
fill_attribute
</p>
</li>
<li><p>
sw_flags
</p>
</li>
<li><p>
startf_flags
</p>
</li>
<li><p>
stdin
</p>
</li>
<li><p>
stdout
</p>
</li>
<li><p>
stderr
</p>
</li>
</ul>
<p>
The relevant constants for &#8216;creation_flags&#8217;,
&#8216;sw_flags&#8217; and &#8216;startf_flags&#8217; are included in the
Windows::Process, Windows::Console and Windows::Window modules. These come
with the windows-pr library, a prerequisite of this library. Note that the
&#8216;stdin&#8217;, &#8216;stdout&#8217; and &#8216;stderr&#8217; options
can be either Ruby IO objects or file descriptors (i.e. a fileno). However,
StringIO objects are not currently supported.
</p>
<p>
If &#8216;stdin&#8217;, &#8216;stdout&#8217; or &#8216;stderr&#8217; are
specified, then the <tt>inherit</tt> value is automatically set to true and
the Process::STARTF_USESTDHANDLES flag is automatically OR&#8217;d to the
<tt>startf_flags</tt> value.
</p>
<p>
The ProcessInfo struct contains the following members:
</p>
<ul>
<li><p>
process_handle - The handle to the newly created process.
</p>
</li>
<li><p>
thread_handle  - The handle to the primary thread of the process.
</p>
</li>
<li><p>
process_id     - <a href="Process.html">Process</a> ID.
</p>
</li>
<li><p>
thread_id      - Thread ID.
</p>
</li>
</ul>
<p>
If the &#8216;close_handles&#8217; option is set to true (the default) then
the process_handle and the thread_handle are automatically closed for you
before the ProcessInfo struct is returned.
</p>
<p>
If the &#8216;with_logon&#8217; option is set, then the process runs the
specified executable file in the security context of the specified
credentials.
</p>
					

					
					<div class="method-source-code"
						id="create-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 708</span>
708:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>(<span class="ruby-identifier">args</span>)
709:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>)
710:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">'Expecting hash-style keyword arguments'</span>
711:     <span class="ruby-keyword kw">end</span>
712:       
713:     <span class="ruby-identifier">valid_keys</span> = <span class="ruby-node">%
714:       app_name command_line inherit creation_flags cwd environment
715:       startup_info thread_inherit process_inherit close_handles with_logon
716:       domain password
717:     /</span>
718: 
719:     <span class="ruby-identifier">valid_si_keys</span> = <span class="ruby-value str">%
720:       startf_flags desktop title x y x_size y_size x_count_chars
721:       y_count_chars fill_attribute sw_flags stdin stdout stderr
722:     /</span>
723: 
724:     <span class="ruby-comment cmt"># Set default values</span>
725:     <span class="ruby-identifier">hash</span> = {
726:       <span class="ruby-value str">'app_name'</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
727:       <span class="ruby-value str">'creation_flags'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
728:       <span class="ruby-value str">'close_handles'</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
729:     }
730:       
731:     <span class="ruby-comment cmt"># Validate the keys, and convert symbols and case to lowercase strings.     </span>
732:     <span class="ruby-identifier">args</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
733:       <span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
734:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">valid_keys</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>)
735:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;invalid key '#{key}'&quot;</span>
736:       <span class="ruby-keyword kw">end</span>
737:       <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">val</span>
738:     }
739:       
740:     <span class="ruby-identifier">si_hash</span> = {}
741:       
742:     <span class="ruby-comment cmt"># If the startup_info key is present, validate its subkeys</span>
743:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'startup_info'</span>]
744:       <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'startup_info'</span>].<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
745:         <span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
746:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">valid_si_keys</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>)
747:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;invalid startup_info key '#{key}'&quot;</span>
748:         <span class="ruby-keyword kw">end</span>
749:         <span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">val</span>
750:       }
751:     <span class="ruby-keyword kw">end</span>
752:       
753:     <span class="ruby-comment cmt"># The +command_line+ key is mandatory unless the +app_name+ key</span>
754:     <span class="ruby-comment cmt"># is specified.</span>
755:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'command_line'</span>]
756:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>]
757:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'command_line'</span>] = <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>]
758:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>] = <span class="ruby-keyword kw">nil</span>
759:       <span class="ruby-keyword kw">else</span>
760:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">'command_line or app_name must be specified'</span>
761:       <span class="ruby-keyword kw">end</span>
762:     <span class="ruby-keyword kw">end</span>
763:       
764:     <span class="ruby-comment cmt"># The environment string should be passed as a string of ';' separated</span>
765:     <span class="ruby-comment cmt"># paths.</span>
766:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'environment'</span>] 
767:       <span class="ruby-identifier">env</span> = <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'environment'</span>].<span class="ruby-identifier">split</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span>
768:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'with_logon'</span>]
769:         <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">e</span>) }
770:         <span class="ruby-identifier">env</span> = [<span class="ruby-identifier">env</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\00\\00&quot;&quot;</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'p*'</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>            
771:       <span class="ruby-keyword kw">else</span>
772:         <span class="ruby-identifier">env</span> = [<span class="ruby-identifier">env</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\00&quot;&quot;</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'p*'</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
773:       <span class="ruby-keyword kw">end</span>
774:     <span class="ruby-keyword kw">else</span>
775:       <span class="ruby-identifier">env</span> = <span class="ruby-keyword kw">nil</span>
776:     <span class="ruby-keyword kw">end</span>
777: 
778:     <span class="ruby-identifier">startinfo</span> = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>]
779:     <span class="ruby-identifier">startinfo</span> = <span class="ruby-identifier">startinfo</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLLLLLLLLLLLSSLLLL'</span>)
780:     <span class="ruby-identifier">procinfo</span>  = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLLL'</span>)
781: 
782:     <span class="ruby-comment cmt"># Process SECURITY_ATTRIBUTE structure</span>
783:     <span class="ruby-identifier">process_security</span> = <span class="ruby-value">0</span>
784:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'process_inherit'</span>]
785:       <span class="ruby-identifier">process_security</span> = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLL'</span>)
786:       <span class="ruby-identifier">process_security</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>] = [<span class="ruby-value">12</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-comment cmt"># sizeof(SECURITY_ATTRIBUTE)</span>
787:       <span class="ruby-identifier">process_security</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>] = [<span class="ruby-value">1</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)  <span class="ruby-comment cmt"># TRUE</span>
788:     <span class="ruby-keyword kw">end</span>
789: 
790:     <span class="ruby-comment cmt"># Thread SECURITY_ATTRIBUTE structure</span>
791:     <span class="ruby-identifier">thread_security</span> = <span class="ruby-value">0</span>
792:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'thread_inherit'</span>]
793:       <span class="ruby-identifier">thread_security</span> = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLL'</span>)
794:       <span class="ruby-identifier">thread_security</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>] = [<span class="ruby-value">12</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-comment cmt"># sizeof(SECURITY_ATTRIBUTE)</span>
795:       <span class="ruby-identifier">thread_security</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>] = [<span class="ruby-value">1</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)  <span class="ruby-comment cmt"># TRUE</span>
796:     <span class="ruby-keyword kw">end</span>
797: 
798:     <span class="ruby-comment cmt"># Automatically handle stdin, stdout and stderr as either IO objects</span>
799:     <span class="ruby-comment cmt"># or file descriptors.  This won't work for StringIO, however.</span>
800:     [<span class="ruby-value str">'stdin'</span>, <span class="ruby-value str">'stdout'</span>, <span class="ruby-value str">'stderr'</span>].<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
801:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">io</span>]
802:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">io</span>].<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:fileno</span>)
803:           <span class="ruby-identifier">handle</span> = <span class="ruby-identifier">get_osfhandle</span>(<span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">io</span>].<span class="ruby-identifier">fileno</span>)
804:         <span class="ruby-keyword kw">else</span>
805:           <span class="ruby-identifier">handle</span> = <span class="ruby-identifier">get_osfhandle</span>(<span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">io</span>])
806:         <span class="ruby-keyword kw">end</span>
807:             
808:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
809:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
810:         <span class="ruby-keyword kw">end</span>
811: 
812:         <span class="ruby-comment cmt"># Most implementations of Ruby on Windows create inheritable</span>
813:         <span class="ruby-comment cmt"># handles by default, but some do not. RF bug #26988.</span>
814:         <span class="ruby-identifier">bool</span> = <span class="ruby-constant">SetHandleInformation</span>(
815:           <span class="ruby-identifier">handle</span>,
816:           <span class="ruby-constant">HANDLE_FLAG_INHERIT</span>,
817:           <span class="ruby-constant">HANDLE_FLAG_INHERIT</span>
818:         )
819: 
820:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bool</span>
821:             
822:         <span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">io</span>] = <span class="ruby-identifier">handle</span>
823:         <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'startf_flags'</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
824:         <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'startf_flags'</span>] <span class="ruby-operator">|=</span> <span class="ruby-constant">STARTF_USESTDHANDLES</span>
825:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'inherit'</span>] = <span class="ruby-keyword kw">true</span>
826:       <span class="ruby-keyword kw">end</span>
827:     }
828:       
829:     <span class="ruby-comment cmt"># The bytes not covered here are reserved (null)</span>
830:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">si_hash</span>.<span class="ruby-identifier">empty?</span>
831:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>]  = [<span class="ruby-identifier">startinfo</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
832:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>]  = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'desktop'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'p*'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'desktop'</span>]
833:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">12</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'title'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'p*'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'title'</span>]
834:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x'</span>]
835:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">20</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y'</span>]
836:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">24</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x_size'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x_size'</span>]
837:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">28</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y_size'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y_size'</span>]
838:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">32</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x_count_chars'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x_count_chars'</span>]
839:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">36</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y_count_chars'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y_count_chars'</span>]
840:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">40</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'fill_attribute'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'fill_attribute'</span>]
841:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">44</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'startf_flags'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'startf_flags'</span>]
842:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">48</span>,<span class="ruby-value">2</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'sw_flags'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'S'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'sw_flags'</span>]
843:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">56</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stdin'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stdin'</span>]
844:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">60</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stdout'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stdout'</span>]
845:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">64</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stderr'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stderr'</span>]        
846:     <span class="ruby-keyword kw">end</span>
847: 
848:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'with_logon'</span>]
849:       <span class="ruby-identifier">logon</span>  = <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'with_logon'</span>])
850:       <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'domain'</span>])
851:       <span class="ruby-identifier">app</span>    = <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>])
852:       <span class="ruby-identifier">cmd</span>    = <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'command_line'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'command_line'</span>])
853:       <span class="ruby-identifier">cwd</span>    = <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'cwd'</span>])
854:       <span class="ruby-identifier">passwd</span> = <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'password'</span>])
855:          
856:       <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'creation_flags'</span>] <span class="ruby-operator">|=</span> <span class="ruby-constant">CREATE_UNICODE_ENVIRONMENT</span>
857: 
858:       <span class="ruby-identifier">bool</span> = <span class="ruby-constant">CreateProcessWithLogonW</span>(
859:         <span class="ruby-identifier">logon</span>,                  <span class="ruby-comment cmt"># User</span>
860:         <span class="ruby-identifier">domain</span>,                 <span class="ruby-comment cmt"># Domain</span>
861:         <span class="ruby-identifier">passwd</span>,                 <span class="ruby-comment cmt"># Password</span>
862:         <span class="ruby-constant">LOGON_WITH_PROFILE</span>,     <span class="ruby-comment cmt"># Logon flags</span>
863:         <span class="ruby-identifier">app</span>,                    <span class="ruby-comment cmt"># App name</span>
864:         <span class="ruby-identifier">cmd</span>,                    <span class="ruby-comment cmt"># Command line</span>
865:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'creation_flags'</span>], <span class="ruby-comment cmt"># Creation flags</span>
866:         <span class="ruby-identifier">env</span>,                    <span class="ruby-comment cmt"># Environment</span>
867:         <span class="ruby-identifier">cwd</span>,                    <span class="ruby-comment cmt"># Working directory</span>
868:         <span class="ruby-identifier">startinfo</span>,              <span class="ruby-comment cmt"># Startup Info</span>
869:         <span class="ruby-identifier">procinfo</span>                <span class="ruby-comment cmt"># Process Info</span>
870:       )
871:     <span class="ruby-keyword kw">else</span>     
872:       <span class="ruby-identifier">bool</span> = <span class="ruby-constant">CreateProcess</span>(
873:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>],       <span class="ruby-comment cmt"># App name</span>
874:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'command_line'</span>],   <span class="ruby-comment cmt"># Command line</span>
875:         <span class="ruby-identifier">process_security</span>,       <span class="ruby-comment cmt"># Process attributes</span>
876:         <span class="ruby-identifier">thread_security</span>,        <span class="ruby-comment cmt"># Thread attributes</span>
877:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'inherit'</span>],        <span class="ruby-comment cmt"># Inherit handles?</span>
878:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'creation_flags'</span>], <span class="ruby-comment cmt"># Creation flags</span>
879:         <span class="ruby-identifier">env</span>,                    <span class="ruby-comment cmt"># Environment</span>
880:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'cwd'</span>],            <span class="ruby-comment cmt"># Working directory</span>
881:         <span class="ruby-identifier">startinfo</span>,              <span class="ruby-comment cmt"># Startup Info</span>
882:         <span class="ruby-identifier">procinfo</span>                <span class="ruby-comment cmt"># Process Info</span>
883:       )
884:     <span class="ruby-keyword kw">end</span>      
885:       
886:     <span class="ruby-comment cmt"># TODO: Close stdin, stdout and stderr handles in the si_hash unless</span>
887:     <span class="ruby-comment cmt"># they're pointing to one of the standard handles already. [Maybe]</span>
888:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bool</span>
889:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;CreateProcess() failed: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">get_last_error</span>
890:     <span class="ruby-keyword kw">end</span>
891:       
892:     <span class="ruby-comment cmt"># Automatically close the process and thread handles in the</span>
893:     <span class="ruby-comment cmt"># PROCESS_INFORMATION struct unless explicitly told not to.</span>
894:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'close_handles'</span>]
895:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">procinfo</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>)
896:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">procinfo</span>[<span class="ruby-value">4</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>)
897:     <span class="ruby-keyword kw">end</span>      
898:       
899:     <span class="ruby-constant">ProcessInfo</span>.<span class="ruby-identifier">new</span>(
900:       <span class="ruby-identifier">procinfo</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>, <span class="ruby-comment cmt"># hProcess</span>
901:       <span class="ruby-identifier">procinfo</span>[<span class="ruby-value">4</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>, <span class="ruby-comment cmt"># hThread</span>
902:       <span class="ruby-identifier">procinfo</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>, <span class="ruby-comment cmt"># hProcessId</span>
903:       <span class="ruby-identifier">procinfo</span>[<span class="ruby-value">12</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span> <span class="ruby-comment cmt"># hThreadId</span>
904:     )
905:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="fork-method" class="method-detail ">
				<a name="method-c-fork"></a>

				<div class="method-heading">
				
					<span class="method-name">fork</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Creates the equivalent of a subshell via the CreateProcess() function. This
behaves in a manner that is similar, but not identical to, the <a
href="Kernel.html#method-i-fork">Kernel.fork</a> method for Unix. Unlike
the Unix fork, this method starts from the top of the script rather than
the point of the call.
</p>
<p>
WARNING: This implementation should be considered experimental. It is not
recommended for production use.
</p>
					

					
					<div class="method-source-code"
						id="fork-source">
<pre>
      <span class="ruby-comment cmt"># File lib/win32/process.rb, line 1086</span>
1086:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fork</span>
1087:     <span class="ruby-identifier">last_arg</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">last</span>
1088:       
1089:     <span class="ruby-comment cmt"># Look for the 'child#xxx' tag</span>
1090:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last_arg</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/child#\d+/</span>
1091:       <span class="ruby-ivar">@i</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
1092:       <span class="ruby-identifier">num</span> = <span class="ruby-identifier">last_arg</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'#'</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">to_i</span>
1093:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">num</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@i</span>
1094:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
1095:           <span class="ruby-identifier">status</span> = <span class="ruby-value">0</span>
1096:           <span class="ruby-keyword kw">begin</span>
1097:             <span class="ruby-keyword kw">yield</span>
1098:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>
1099:             <span class="ruby-identifier">status</span> = <span class="ruby-value">1</span> <span class="ruby-comment cmt"># Any non-zero result is failure</span>
1100:           <span class="ruby-keyword kw">ensure</span>
1101:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">status</span>
1102:           <span class="ruby-keyword kw">end</span>
1103:         <span class="ruby-keyword kw">end</span>
1104:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
1105:       <span class="ruby-keyword kw">else</span>
1106:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
1107:       <span class="ruby-keyword kw">end</span>
1108:     <span class="ruby-keyword kw">end</span>
1109:    
1110:     <span class="ruby-comment cmt"># Tag the command with the word 'child#xxx' to distinguish it</span>
1111:     <span class="ruby-comment cmt"># from the calling process.</span>
1112:     <span class="ruby-identifier">cmd</span> = <span class="ruby-value str">'ruby -I &quot;'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&quot; &quot;'</span>
1113:     <span class="ruby-identifier">cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">$PROGRAM_NAME</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&quot; '</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
1114:     <span class="ruby-identifier">cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' child#'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">to_s</span>
1115:       
1116:     <span class="ruby-identifier">startinfo</span> = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>]
1117:     <span class="ruby-identifier">startinfo</span> = <span class="ruby-identifier">startinfo</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLLLLLLLLLLLSSLLLL'</span>)
1118:     <span class="ruby-identifier">procinfo</span>  = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLLL'</span>)
1119:       
1120:     <span class="ruby-identifier">rv</span> = <span class="ruby-constant">CreateProcess</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">cmd</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">1</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">startinfo</span>, <span class="ruby-identifier">procinfo</span>)
1121:       
1122:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rv</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
1123:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
1124:     <span class="ruby-keyword kw">end</span>
1125:       
1126:     <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">procinfo</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
1127:     <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
1128:       
1129:     <span class="ruby-identifier">pid</span> 
1130:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="get-affinity-method" class="method-detail ">
				<a name="method-c-get_affinity"></a>

				<div class="method-heading">
				
					<span class="method-name">get_affinity</span><span
						class="method-args">(int = Process.pid)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns the process and system affinity mask for the given <tt>pid</tt>, or
the current process if no pid is provided. The return value is a two
element array, with the first containing the process affinity mask, and the
second containing the system affinity mask. Both are decimal values.
</p>
<p>
A process affinity mask is a bit vector indicating the processors that a
process is allowed to run on. A system affinity mask is a bit vector in
which each bit represents the processors that are configured into a system.
</p>
<p>
Example:
</p>
<pre>
   # System has 4 processors, current process is allowed to run on all
   Process.get_affinity # =&gt; [[15], [15]]

   # System has 4 processors, current process only allowed on 1 and 4 only
   Process.get_affinity # =&gt; [[9], [15]]
</pre>
<p>
If you want to convert a decimal bit vector into an array of 0&#8217;s and
1&#8217;s indicating the flag value of each processor, you can use
something like this approach:
</p>
<pre>
   mask = Process.get_affinity.first
   (0..mask).to_a.map{ |n| mask[n] }</pre>
					

					
					<div class="method-source-code"
						id="get-affinity-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 106</span>
106:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_affinity</span>(<span class="ruby-identifier">int</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>)
107:     <span class="ruby-identifier">pmask</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
108:     <span class="ruby-identifier">smask</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
109: 
110:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">int</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>
111:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">GetProcessAffinityMask</span>(<span class="ruby-constant">GetCurrentProcess</span>(), <span class="ruby-identifier">pmask</span>, <span class="ruby-identifier">smask</span>)
112:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
113:       <span class="ruby-keyword kw">end</span>
114:     <span class="ruby-keyword kw">else</span>
115:       <span class="ruby-keyword kw">begin</span>
116:         <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_QUERY_INFORMATION</span>, <span class="ruby-value">0</span> , <span class="ruby-identifier">int</span>)
117: 
118:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
119:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
120:         <span class="ruby-keyword kw">end</span>
121: 
122:         <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">GetProcessAffinityMask</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">pmask</span>, <span class="ruby-identifier">smask</span>)
123:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
124:         <span class="ruby-keyword kw">end</span>
125:       <span class="ruby-keyword kw">ensure</span>
126:         <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
127:       <span class="ruby-keyword kw">end</span>
128:     <span class="ruby-keyword kw">end</span>
129: 
130:     <span class="ruby-identifier">pmask</span> = <span class="ruby-identifier">pmask</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
131:     <span class="ruby-identifier">smask</span> = <span class="ruby-identifier">smask</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
132: 
133:     [<span class="ruby-identifier">pmask</span>, <span class="ruby-identifier">smask</span>]
134:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="getpriority-method" class="method-detail ">
				<a name="method-c-getpriority"></a>

				<div class="method-heading">
				
					<span class="method-name">getpriority</span><span
						class="method-args">(kind, int)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Retrieves the priority class for the specified process id <tt>int</tt>.
Unlike the default implementation, lower return values do not necessarily
correspond to higher priority classes.
</p>
<p>
The <tt>kind</tt> parameter is ignored but required for API compatibility.
You can only retrieve process information, not process group or user
information, so it is effectively always Process::PRIO_PROCESS.
</p>
<p>
Possible return values are:
</p>
<p>
32    - Process::NORMAL_PRIORITY_CLASS 64    - Process::IDLE_PRIORITY_CLASS
128   - Process::HIGH_PRIORITY_CLASS 256   -
Process::REALTIME_PRIORITY_CLASS 16384 -
Process::BELOW_NORMAL_PRIORITY_CLASS 32768 -
Process::ABOVE_NORMAL_PRIORITY_CLASS
</p>
					

					
					<div class="method-source-code"
						id="getpriority-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 332</span>
332:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getpriority</span>(<span class="ruby-identifier">kind</span>, <span class="ruby-identifier">int</span>)
333:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">kind</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
334:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">int</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
335: 
336:     <span class="ruby-identifier">int</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">int</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># Match spec</span>
337: 
338:     <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_QUERY_INFORMATION</span>, <span class="ruby-value">0</span> , <span class="ruby-identifier">int</span>)
339: 
340:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
341:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
342:     <span class="ruby-keyword kw">end</span>
343: 
344:     <span class="ruby-keyword kw">begin</span>
345:       <span class="ruby-identifier">priority_class</span> = <span class="ruby-constant">GetPriorityClass</span>(<span class="ruby-identifier">handle</span>)
346: 
347:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">priority_class</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
348:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
349:       <span class="ruby-keyword kw">end</span>
350:     <span class="ruby-keyword kw">ensure</span>
351:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>)
352:     <span class="ruby-keyword kw">end</span>
353: 
354:     <span class="ruby-identifier">priority_class</span>
355:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="getrlimit-method" class="method-detail ">
				<a name="method-c-getrlimit"></a>

				<div class="method-heading">
				
					<span class="method-name">getrlimit</span><span
						class="method-args">(resource)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Gets the resource limit of the current process. Only a limited number of
flags are supported.
</p>
<p>
Process::RLIMIT_CPU Process::RLIMIT_FSIZE Process::RLIMIT_AS
Process::RLIMIT_RSS Process::RLIMIT_VMEM
</p>
<p>
The Process:RLIMIT_AS, Process::RLIMIT_RSS and Process::VMEM constants all
refer to the <a href="Process.html">Process</a> memory limit. The
Process::RLIMIT_CPU constant refers to the per process user time limit. The
Process::RLIMIT_FSIZE constant is hard coded to the maximum file size on an
NTFS filesystem, approximately 4TB (or 4GB if not NTFS).
</p>
<p>
While a two element array is returned in order to comply with the spec,
there is no separate hard and soft limit. The values will always be the
same.
</p>
<p>
If [0,0] is returned then it means no limit has been set.
</p>
<p>
Example:
</p>
<pre>
  Process.getrlimit(Process::RLIMIT_VMEM) # =&gt; [0, 0]</pre>
					

					
					<div class="method-source-code"
						id="getrlimit-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 175</span>
175:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getrlimit</span>(<span class="ruby-identifier">resource</span>)
176:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">resource</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RLIMIT_FSIZE</span>
177:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">get_volume_type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'NTFS'</span>
178:         <span class="ruby-keyword kw">return</span> ((<span class="ruby-value">1024</span><span class="ruby-operator">**</span><span class="ruby-value">4</span>) * <span class="ruby-value">4</span>) <span class="ruby-operator">-</span> (<span class="ruby-value">1024</span> * <span class="ruby-value">64</span>) <span class="ruby-comment cmt"># ~4 TB</span>
179:       <span class="ruby-keyword kw">else</span>
180:         <span class="ruby-keyword kw">return</span> (<span class="ruby-value">1024</span><span class="ruby-operator">**</span><span class="ruby-value">3</span>) * <span class="ruby-value">4</span> <span class="ruby-comment cmt"># 4 GB</span>
181:       <span class="ruby-keyword kw">end</span>
182:     <span class="ruby-keyword kw">end</span>
183: 
184:     <span class="ruby-identifier">handle</span> = <span class="ruby-keyword kw">nil</span>
185:     <span class="ruby-identifier">in_job</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">job?</span>
186: 
187:     <span class="ruby-comment cmt"># Put the current process in a job if it's not already in one</span>
188:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_job</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@job_name</span>)
189:       <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenJobObject</span>(<span class="ruby-constant">JOB_OBJECT_QUERY</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-ivar">@job_name</span>)
190:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
191:     <span class="ruby-keyword kw">else</span>
192:       <span class="ruby-ivar">@job_name</span> = <span class="ruby-value str">'ruby_'</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>.<span class="ruby-identifier">to_s</span>
193:       <span class="ruby-identifier">handle</span> = <span class="ruby-constant">CreateJobObject</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-ivar">@job_name</span>)
194:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
195:     <span class="ruby-keyword kw">end</span>
196: 
197:     <span class="ruby-keyword kw">begin</span>
198:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">in_job</span>
199:         <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">AssignProcessToJobObject</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-constant">GetCurrentProcess</span>())
200:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
201:         <span class="ruby-keyword kw">end</span>
202:       <span class="ruby-keyword kw">end</span>
203: 
204:       <span class="ruby-identifier">buf</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">112</span> <span class="ruby-comment cmt"># sizeof(struct JOBJECT_EXTENDED_LIMIT_INFORMATION)</span>
205:       <span class="ruby-identifier">val</span> = <span class="ruby-keyword kw">nil</span>         <span class="ruby-comment cmt"># value returned at end of method</span>
206: 
207:       <span class="ruby-comment cmt"># Set the LimitFlags member of the struct</span>
208:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">resource</span>
209:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RLIMIT_CPU</span>
210:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>] = [<span class="ruby-constant">JOB_OBJECT_LIMIT_PROCESS_TIME</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
211:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RLIMIT_AS</span>, <span class="ruby-constant">RLIMIT_VMEM</span>, <span class="ruby-constant">RLIMIT_RSS</span>
212:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>] = [<span class="ruby-constant">JOB_OBJECT_LIMIT_PROCESS_MEMORY</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
213:         <span class="ruby-keyword kw">else</span>
214:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;unsupported resource type&quot;</span>
215:       <span class="ruby-keyword kw">end</span>
216: 
217:       <span class="ruby-identifier">bool</span> = <span class="ruby-constant">QueryInformationJobObject</span>(
218:         <span class="ruby-identifier">handle</span>,
219:         <span class="ruby-constant">JobObjectExtendedLimitInformation</span>,
220:         <span class="ruby-identifier">buf</span>,
221:         <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">size</span>,
222:         <span class="ruby-keyword kw">nil</span>
223:       )
224: 
225:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bool</span>
226:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
227:       <span class="ruby-keyword kw">end</span>
228: 
229:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">resource</span>
230:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Process</span><span class="ruby-operator">::</span><span class="ruby-constant">RLIMIT_CPU</span>
231:           <span class="ruby-identifier">val</span> = <span class="ruby-identifier">buf</span>[<span class="ruby-value">0</span>,<span class="ruby-value">8</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'Q'</span>).<span class="ruby-identifier">first</span>
232:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RLIMIT_AS</span>, <span class="ruby-constant">RLIMIT_VMEM</span>, <span class="ruby-constant">RLIMIT_RSS</span>
233:           <span class="ruby-identifier">val</span> = <span class="ruby-identifier">buf</span>[<span class="ruby-value">96</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
234:       <span class="ruby-keyword kw">end</span>
235:     <span class="ruby-keyword kw">ensure</span>
236:       <span class="ruby-identifier">at_exit</span>{ <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> }
237:     <span class="ruby-keyword kw">end</span>
238: 
239:     [<span class="ruby-identifier">val</span>, <span class="ruby-identifier">val</span>] <span class="ruby-comment cmt"># Return an array of two values to comply with spec</span>
240:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="job--method" class="method-detail ">
				<a name="method-c-job%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">job?</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns whether or not the current process is part of a Job.
</p>
					

					
					<div class="method-source-code"
						id="job--source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 138</span>
138:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">job?</span>
139:     <span class="ruby-identifier">pbool</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
140:     <span class="ruby-constant">IsProcessInJob</span>(<span class="ruby-constant">GetCurrentProcess</span>(), <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">pbool</span>)
141:     <span class="ruby-identifier">pbool</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">true</span>
142:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="kill-method" class="method-detail ">
				<a name="method-c-kill"></a>

				<div class="method-heading">
				
					<span class="method-name">kill</span><span
						class="method-args">(signal, *pids)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Sends the given <tt>signal</tt> to an array of process id&#8217;s. The
<tt>signal</tt> may be any value from 0 to 9, or the special strings
&#8216;SIGINT&#8217; (or &#8216;INT&#8217;), &#8216;SIGBRK&#8217; (or
&#8216;BRK&#8217;) and &#8216;SIGKILL&#8217; (or &#8216;KILL&#8217;). An
array of successfully killed pids is returned.
</p>
<p>
Signal 0 merely tests if the process is running without killing it. Signal
2 sends a CTRL_C_EVENT to the process. Signal 3 sends a CTRL_BRK_EVENT to
the process. Signal 9 kills the process in a harsh manner. Signals 1 and
4-8 kill the process in a nice manner.
</p>
<p>
SIGINT/INT corresponds to signal 2 SIGBRK/BRK corresponds to signal 3
SIGKILL/KILL corresponds to signal 9
</p>
<p>
Signals 2 and 3 only affect console processes, and then only if the process
was created with the CREATE_NEW_PROCESS_GROUP flag.
</p>
					

					
					<div class="method-source-code"
						id="kill-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 539</span>
539:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">kill</span>(<span class="ruby-identifier">signal</span>, *<span class="ruby-identifier">pids</span>)
540:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">signal</span>
541:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'SIGINT'</span>, <span class="ruby-value str">'INT'</span>
542:         <span class="ruby-identifier">signal</span> = <span class="ruby-value">2</span>
543:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'SIGBRK'</span>, <span class="ruby-value str">'BRK'</span>
544:         <span class="ruby-identifier">signal</span> = <span class="ruby-value">3</span>
545:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'SIGKILL'</span>, <span class="ruby-value str">'KILL'</span>
546:         <span class="ruby-identifier">signal</span> = <span class="ruby-value">9</span>
547:       <span class="ruby-keyword kw">when</span> <span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">9</span>
548:         <span class="ruby-comment cmt"># Do nothing</span>
549:       <span class="ruby-keyword kw">else</span>
550:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;Invalid signal '#{signal}'&quot;</span>
551:     <span class="ruby-keyword kw">end</span>
552:       
553:     <span class="ruby-identifier">killed_pids</span> = []
554:       
555:     <span class="ruby-identifier">pids</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pid</span><span class="ruby-operator">|</span>
556:       <span class="ruby-comment cmt"># Send the signal to the current process if the pid is zero</span>
557:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
558:         <span class="ruby-identifier">pid</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>
559:       <span class="ruby-keyword kw">end</span>
560:        
561:       <span class="ruby-comment cmt"># No need for full access if the signal is zero</span>
562:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">signal</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
563:         <span class="ruby-identifier">access</span> = <span class="ruby-constant">PROCESS_QUERY_INFORMATION</span> <span class="ruby-operator">|</span> <span class="ruby-constant">PROCESS_VM_READ</span>
564:         <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-identifier">access</span>, <span class="ruby-value">0</span> , <span class="ruby-identifier">pid</span>)
565:       <span class="ruby-keyword kw">else</span>
566:         <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_ALL_ACCESS</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">pid</span>)
567:       <span class="ruby-keyword kw">end</span>
568:          
569:       <span class="ruby-keyword kw">begin</span>
570:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">signal</span>
571:           <span class="ruby-keyword kw">when</span> <span class="ruby-value">0</span>   
572:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
573:               <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
574:             <span class="ruby-keyword kw">else</span>
575:               <span class="ruby-comment cmt"># If ERROR_ACCESS_DENIED is returned, we know it's running</span>
576:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">GetLastError</span>() <span class="ruby-operator">==</span> <span class="ruby-constant">ERROR_ACCESS_DENIED</span>
577:                 <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
578:               <span class="ruby-keyword kw">else</span>
579:                 <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
580:               <span class="ruby-keyword kw">end</span>
581:             <span class="ruby-keyword kw">end</span>
582:           <span class="ruby-keyword kw">when</span> <span class="ruby-value">2</span>
583:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">GenerateConsoleCtrlEvent</span>(<span class="ruby-constant">CTRL_C_EVENT</span>, <span class="ruby-identifier">pid</span>)
584:               <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
585:             <span class="ruby-keyword kw">end</span>
586:           <span class="ruby-keyword kw">when</span> <span class="ruby-value">3</span>
587:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">GenerateConsoleCtrlEvent</span>(<span class="ruby-constant">CTRL_BREAK_EVENT</span>, <span class="ruby-identifier">pid</span>)
588:               <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
589:             <span class="ruby-keyword kw">end</span>
590:           <span class="ruby-keyword kw">when</span> <span class="ruby-value">9</span>
591:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TerminateProcess</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">pid</span>)
592:               <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
593:               <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)           
594:             <span class="ruby-keyword kw">else</span>
595:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
596:             <span class="ruby-keyword kw">end</span>
597:           <span class="ruby-keyword kw">else</span>
598:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
599:               <span class="ruby-identifier">thread_id</span> = [<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
600:               <span class="ruby-keyword kw">begin</span> 
601:                 <span class="ruby-identifier">thread</span> = <span class="ruby-constant">CreateRemoteThread</span>(
602:                   <span class="ruby-identifier">handle</span>,
603:                   <span class="ruby-value">0</span>,
604:                   <span class="ruby-value">0</span>,
605:                   <span class="ruby-constant">GetProcAddress</span>(<span class="ruby-constant">GetModuleHandle</span>(<span class="ruby-value str">'kernel32'</span>), <span class="ruby-value str">'ExitProcess'</span>),
606:                   <span class="ruby-value">0</span>,
607:                   <span class="ruby-value">0</span>,
608:                   <span class="ruby-identifier">thread_id</span>
609:                 )
610: 
611:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">thread</span>
612:                   <span class="ruby-constant">WaitForSingleObject</span>(<span class="ruby-identifier">thread</span>, <span class="ruby-value">5</span>)
613:                   <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
614:                   <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
615:                 <span class="ruby-keyword kw">else</span>
616:                   <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
617:                 <span class="ruby-keyword kw">end</span>
618:               <span class="ruby-keyword kw">ensure</span>
619:                 <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">thread</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">thread</span>
620:               <span class="ruby-keyword kw">end</span>
621:             <span class="ruby-keyword kw">else</span>
622:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
623:           <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># case</span>
624: 
625:           <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
626:         <span class="ruby-keyword kw">end</span>
627:       <span class="ruby-keyword kw">ensure</span>
628:         <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
629:       <span class="ruby-keyword kw">end</span>
630:     }
631:       
632:     <span class="ruby-identifier">killed_pids</span>
633:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="ppid-method" class="method-detail ">
				<a name="method-c-ppid"></a>

				<div class="method-heading">
				
					<span class="method-name">ppid</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns the process ID of the parent of this process.
</p>
					

					
					<div class="method-source-code"
						id="ppid-source">
<pre>
      <span class="ruby-comment cmt"># File lib/win32/process.rb, line 1045</span>
1045:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ppid</span>
1046:     <span class="ruby-identifier">ppid</span> = <span class="ruby-value">0</span>
1047: 
1048:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ppid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># Paranoia</span>
1049: 
1050:     <span class="ruby-identifier">handle</span> = <span class="ruby-constant">CreateToolhelp32Snapshot</span>(<span class="ruby-constant">TH32CS_SNAPPROCESS</span>, <span class="ruby-value">0</span>)
1051: 
1052:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
1053:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
1054:     <span class="ruby-keyword kw">end</span>
1055: 
1056:     <span class="ruby-identifier">proc_entry</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">296</span> <span class="ruby-comment cmt"># 36 + 260</span>
1057:     <span class="ruby-identifier">proc_entry</span>[<span class="ruby-value">0</span>, <span class="ruby-value">4</span>] = [<span class="ruby-identifier">proc_entry</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-comment cmt"># Set dwSize member</span>
1058:       
1059:     <span class="ruby-keyword kw">begin</span>             
1060:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Process32First</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">proc_entry</span>)
1061:         <span class="ruby-identifier">error</span> = <span class="ruby-identifier">get_last_error</span>
1062:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">error</span>
1063:       <span class="ruby-keyword kw">end</span>
1064: 
1065:       <span class="ruby-keyword kw">while</span> <span class="ruby-constant">Process32Next</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">proc_entry</span>)
1066:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">proc_entry</span>[<span class="ruby-value">8</span>, <span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>)[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>
1067:           <span class="ruby-identifier">ppid</span> = <span class="ruby-identifier">proc_entry</span>[<span class="ruby-value">24</span>, <span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>)[<span class="ruby-value">0</span>] <span class="ruby-comment cmt"># th32ParentProcessID</span>
1068:           <span class="ruby-keyword kw">break</span>
1069:         <span class="ruby-keyword kw">end</span>
1070:       <span class="ruby-keyword kw">end</span>
1071:     <span class="ruby-keyword kw">ensure</span>
1072:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>)
1073:     <span class="ruby-keyword kw">end</span>
1074: 
1075:     <span class="ruby-identifier">ppid</span>
1076:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="setpriority-method" class="method-detail ">
				<a name="method-c-setpriority"></a>

				<div class="method-heading">
				
					<span class="method-name">setpriority</span><span
						class="method-args">(kind, int, int_priority)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Sets the priority class for the specified process id <tt>int</tt>.
</p>
<p>
The <tt>kind</tt> parameter is ignored but present for API compatibility.
You can only retrieve process information, not process group or user
information, so it is effectively always Process::PRIO_PROCESS.
</p>
<p>
Possible <tt>int_priority</tt> values are:
</p>
<ul>
<li><p>
Process::NORMAL_PRIORITY_CLASS
</p>
</li>
<li><p>
Process::IDLE_PRIORITY_CLASS
</p>
</li>
<li><p>
Process::HIGH_PRIORITY_CLASS
</p>
</li>
<li><p>
Process::REALTIME_PRIORITY_CLASS
</p>
</li>
<li><p>
Process::BELOW_NORMAL_PRIORITY_CLASS
</p>
</li>
<li><p>
Process::ABOVE_NORMAL_PRIORITY_CLASS
</p>
</li>
</ul>
					

					
					<div class="method-source-code"
						id="setpriority-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 372</span>
372:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setpriority</span>(<span class="ruby-identifier">kind</span>, <span class="ruby-identifier">int</span>, <span class="ruby-identifier">int_priority</span>)
373:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">kind</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
374:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">int</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
375:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">int_priority</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
376: 
377:     <span class="ruby-identifier">int</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">int</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># Match spec</span>
378: 
379:     <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_SET_INFORMATION</span>, <span class="ruby-value">0</span> , <span class="ruby-identifier">int</span>)
380: 
381:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
382:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
383:     <span class="ruby-keyword kw">end</span>
384: 
385:     <span class="ruby-keyword kw">begin</span>
386:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">SetPriorityClass</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">int_priority</span>)
387:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
388:       <span class="ruby-keyword kw">end</span>
389:     <span class="ruby-keyword kw">ensure</span>
390:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>)
391:     <span class="ruby-keyword kw">end</span>
392: 
393:     <span class="ruby-keyword kw">return</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># Match the spec</span>
394:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="setrlimit-method" class="method-detail ">
				<a name="method-c-setrlimit"></a>

				<div class="method-heading">
				
					<span class="method-name">setrlimit</span><span
						class="method-args">(resource, current_limit, max_limit = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Sets the resource limit of the current process. Only a limited number of
flags are supported.
</p>
<p>
Process::RLIMIT_CPU Process::RLIMIT_AS Process::RLIMIT_RSS
Process::RLIMIT_VMEM
</p>
<p>
The Process:RLIMIT_AS, Process::RLIMIT_RSS and Process::VMEM constants all
refer to the <a href="Process.html">Process</a> memory limit. The
Process::RLIMIT_CPU constant refers to the per process user time limit.
</p>
<p>
The <tt>max_limit</tt> parameter is provided for interface compatibility
only. It is always set to the current_limit value.
</p>
<p>
Example:
</p>
<pre>
  Process.setrlimit(Process::RLIMIT_VMEM, 1024 * 4) # =&gt; nil
  Process.getrlimit(Process::RLIMIT_VMEM) # =&gt; [4096, 4096]</pre>
					

					
					<div class="method-source-code"
						id="setrlimit-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 262</span>
262:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setrlimit</span>(<span class="ruby-identifier">resource</span>, <span class="ruby-identifier">current_limit</span>, <span class="ruby-identifier">max_limit</span> = <span class="ruby-keyword kw">nil</span>)
263:     <span class="ruby-identifier">max_limit</span> = <span class="ruby-identifier">current_limit</span>
264: 
265:     <span class="ruby-identifier">handle</span> = <span class="ruby-keyword kw">nil</span>
266:     <span class="ruby-identifier">in_job</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">job?</span>
267: 
268:     <span class="ruby-comment cmt"># Put the current process in a job if it's not already in one</span>
269:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_job</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-ivar">@job_name</span>
270:       <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenJobObject</span>(<span class="ruby-constant">JOB_OBJECT_SET_ATTRIBUTES</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-ivar">@job_name</span>)
271:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
272:     <span class="ruby-keyword kw">else</span>
273:       <span class="ruby-ivar">@job_name</span> = <span class="ruby-value str">'ruby_'</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>.<span class="ruby-identifier">to_s</span>
274:       <span class="ruby-identifier">handle</span> = <span class="ruby-constant">CreateJobObject</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">job_name</span>)
275:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
276:     <span class="ruby-keyword kw">end</span>
277: 
278:     <span class="ruby-keyword kw">begin</span>
279:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">in_job</span>
280:         <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">AssignProcessToJobObject</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-constant">GetCurrentProcess</span>())
281:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
282:         <span class="ruby-keyword kw">end</span>
283:       <span class="ruby-keyword kw">end</span>
284: 
285:       <span class="ruby-comment cmt"># sizeof(struct JOBJECT_EXTENDED_LIMIT_INFORMATION)</span>
286:       <span class="ruby-identifier">buf</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">112</span>
287: 
288:       <span class="ruby-comment cmt"># Set the LimitFlags and relevant members of the struct</span>
289:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">resource</span>
290:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RLIMIT_CPU</span>
291:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>] = [<span class="ruby-constant">JOB_OBJECT_LIMIT_PROCESS_TIME</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
292:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">0</span>,<span class="ruby-value">8</span>]  = [<span class="ruby-identifier">max_limit</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'Q'</span>) <span class="ruby-comment cmt"># PerProcessUserTimeLimit</span>
293:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RLIMIT_AS</span>, <span class="ruby-constant">RLIMIT_VMEM</span>, <span class="ruby-constant">RLIMIT_RSS</span>
294:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>] = [<span class="ruby-constant">JOB_OBJECT_LIMIT_PROCESS_MEMORY</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
295:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">96</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">max_limit</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-comment cmt"># ProcessMemoryLimit</span>
296:         <span class="ruby-keyword kw">else</span>
297:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;unsupported resource type&quot;</span>
298:       <span class="ruby-keyword kw">end</span>
299: 
300:       <span class="ruby-identifier">bool</span> = <span class="ruby-constant">SetInformationJobObject</span>(
301:         <span class="ruby-identifier">handle</span>,
302:         <span class="ruby-constant">JobObjectExtendedLimitInformation</span>,
303:         <span class="ruby-identifier">buf</span>,
304:         <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">size</span>
305:       )
306: 
307:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bool</span>
308:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
309:       <span class="ruby-keyword kw">end</span>
310:     <span class="ruby-keyword kw">ensure</span>
311:       <span class="ruby-identifier">at_exit</span>{ <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> }
312:     <span class="ruby-keyword kw">end</span>
313:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="uid-method" class="method-detail ">
				<a name="method-c-uid"></a>

				<div class="method-heading">
				
					<span class="method-name">uid</span><span
						class="method-args">(sid = false)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns the uid of the current process. Specifically, it returns the RID of
the SID associated with the owner of the process.
</p>
<p>
If <tt>sid</tt> is set to true, then a binary sid is returned. Otherwise, a
numeric id is returned (the default).
</p>
					

					
					<div class="method-source-code"
						id="uid-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 404</span>
404:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">uid</span>(<span class="ruby-identifier">sid</span> = <span class="ruby-keyword kw">false</span>)
405:     <span class="ruby-identifier">token</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
406: 
407:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sid</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">TrueClass</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">sid</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">FalseClass</span>)
408: 
409:     <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">OpenProcessToken</span>(<span class="ruby-constant">GetCurrentProcess</span>(), <span class="ruby-constant">TOKEN_QUERY</span>, <span class="ruby-identifier">token</span>)
410:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
411:     <span class="ruby-keyword kw">end</span>
412: 
413:     <span class="ruby-identifier">token</span>   = <span class="ruby-identifier">token</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'V'</span>)[<span class="ruby-value">0</span>]
414:     <span class="ruby-identifier">rlength</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
415:     <span class="ruby-identifier">tuser</span>   = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">512</span>
416: 
417:     <span class="ruby-identifier">bool</span> = <span class="ruby-constant">GetTokenInformation</span>(
418:       <span class="ruby-identifier">token</span>,
419:       <span class="ruby-constant">TokenUser</span>,
420:       <span class="ruby-identifier">tuser</span>,
421:       <span class="ruby-identifier">tuser</span>.<span class="ruby-identifier">size</span>,
422:       <span class="ruby-identifier">rlength</span>
423:     )
424: 
425:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bool</span>
426:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
427:     <span class="ruby-keyword kw">end</span>
428: 
429:     <span class="ruby-identifier">lsid</span> = <span class="ruby-identifier">tuser</span>[<span class="ruby-value">8</span>, (<span class="ruby-identifier">rlength</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">-</span> <span class="ruby-value">8</span>)]
430: 
431:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sid</span>
432:       <span class="ruby-identifier">lsid</span>
433:     <span class="ruby-keyword kw">else</span>
434:       <span class="ruby-identifier">sid_addr</span> = [<span class="ruby-identifier">lsid</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'p*'</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>)[<span class="ruby-value">0</span>]
435:       <span class="ruby-identifier">sid_buf</span>  = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">80</span>
436:       <span class="ruby-identifier">sid_ptr</span>  = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
437: 
438:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">ConvertSidToStringSid</span>(<span class="ruby-identifier">sid_addr</span>, <span class="ruby-identifier">sid_ptr</span>)
439:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
440:       <span class="ruby-keyword kw">end</span>
441: 
442:       <span class="ruby-identifier">strcpy</span>(<span class="ruby-identifier">sid_buf</span>, <span class="ruby-identifier">sid_ptr</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>)[<span class="ruby-value">0</span>])
443:       <span class="ruby-identifier">sid_buf</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'-'</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">to_i</span>
444:     <span class="ruby-keyword kw">end</span>
445:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="wait-method" class="method-detail ">
				<a name="method-c-wait"></a>

				<div class="method-heading">
				
					<span class="method-name">wait</span><span
						class="method-args">(pid = -1, flags = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Waits for any child process to exit and returns the process id of that
child. If a pid is provided that is greater than or equal to 0, then it is
the equivalent of calling <a
href="Process.html#method-i-waitpid">Process.waitpid</a>.
</p>
<p>
The <tt>flags</tt> argument is ignored at the moment. It is provided
strictly for interface compatibility.
</p>
<p>
Note that the $? (Process::Status) global variable is NOT set.  This may be
addressed in a future release.
</p>
					

					
					<div class="method-source-code"
						id="wait-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 920</span>
920:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wait</span>(<span class="ruby-identifier">pid</span> = <span class="ruby-value">1</span>, <span class="ruby-identifier">flags</span> = <span class="ruby-keyword kw">nil</span>)
921:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>
922:       <span class="ruby-identifier">pid</span>, <span class="ruby-identifier">status</span> = <span class="ruby-identifier">waitpid</span>(<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">flags</span>)
923:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pid</span>
924:     <span class="ruby-keyword kw">end</span>
925: 
926:     <span class="ruby-identifier">handles</span> = []
927:       
928:     <span class="ruby-comment cmt"># Windows 2000 or earlier</span>
929:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
930:       <span class="ruby-identifier">pids</span> = []
931:     <span class="ruby-keyword kw">end</span>
932:       
933:     <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">each_with_index</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pid</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
934:       <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_ALL_ACCESS</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">pid</span>)
935:        
936:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
937:         <span class="ruby-identifier">err</span> = <span class="ruby-node">&quot;unable to get HANDLE on process associated with pid #{pid}&quot;</span>
938:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">err</span>
939:       <span class="ruby-keyword kw">end</span>
940:          
941:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
942:         <span class="ruby-identifier">pids</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">pid</span>
943:       <span class="ruby-keyword kw">end</span>      
944:     }
945:     
946:     <span class="ruby-identifier">wait</span> = <span class="ruby-constant">WaitForMultipleObjects</span>(
947:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">size</span>,
948:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L*'</span>),
949:       <span class="ruby-value">0</span>,
950:       <span class="ruby-constant">INFINITE</span>
951:     )
952:       
953:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">wait</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">WAIT_OBJECT_0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">wait</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">WAIT_OBJECT_0</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
954:       <span class="ruby-identifier">index</span> = <span class="ruby-identifier">wait</span> <span class="ruby-operator">-</span> <span class="ruby-constant">WAIT_OBJECT_0</span>         
955:       <span class="ruby-identifier">handle</span> = <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">index</span>]
956:          
957:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
958:         <span class="ruby-identifier">pid</span> = <span class="ruby-constant">GetProcessId</span>(<span class="ruby-identifier">handle</span>)
959:       <span class="ruby-keyword kw">else</span>
960:         <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">pids</span>[<span class="ruby-identifier">index</span>]
961:       <span class="ruby-keyword kw">end</span>
962:          
963:       <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
964:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">handle</span><span class="ruby-operator">|</span> <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) }
965:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pid</span>
966:     <span class="ruby-keyword kw">end</span>
967:       
968:     <span class="ruby-keyword kw">nil</span>
969:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="wait--method" class="method-detail ">
				<a name="method-c-wait2"></a>

				<div class="method-heading">
				
					<span class="method-name">wait2</span><span
						class="method-args">(pid = -1, flags = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Waits for any child process to exit and returns an array containing the
process id and the exit status of that child.
</p>
<p>
The <tt>flags</tt> argument is ignored at the moment. It is provided
strictly for interface compatibility.
</p>
<p>
Note that the $? (Process::Status) global variable is NOT set.  This may be
addressed in a future release.
</p>
					

					
					<div class="method-source-code"
						id="wait--source">
<pre>
      <span class="ruby-comment cmt"># File lib/win32/process.rb, line 983</span>
 983:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wait2</span>(<span class="ruby-identifier">pid</span> = <span class="ruby-value">1</span>, <span class="ruby-identifier">flags</span> = <span class="ruby-keyword kw">nil</span>)
 984:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>
 985:       <span class="ruby-identifier">pid</span>, <span class="ruby-identifier">status</span> = <span class="ruby-identifier">waitpid2</span>(<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">flags</span>)
 986:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pid</span>
 987:     <span class="ruby-keyword kw">end</span>
 988: 
 989:     <span class="ruby-identifier">handles</span> = []
 990:      
 991:     <span class="ruby-comment cmt"># Windows 2000 or earlier</span>
 992:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
 993:       <span class="ruby-identifier">pids</span> = []
 994:     <span class="ruby-keyword kw">end</span>
 995:       
 996:     <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">each_with_index</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pid</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
 997:       <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_ALL_ACCESS</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">pid</span>)
 998:         
 999:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
1000:         <span class="ruby-identifier">err</span> = <span class="ruby-node">&quot;unable to get HANDLE on process associated with pid #{pid}&quot;</span>
1001:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">err</span>
1002:       <span class="ruby-keyword kw">end</span>
1003:         
1004:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
1005:         <span class="ruby-identifier">pids</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">pid</span>
1006:       <span class="ruby-keyword kw">end</span>      
1007:     }
1008:     
1009:     <span class="ruby-identifier">wait</span> = <span class="ruby-constant">WaitForMultipleObjects</span>(
1010:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">size</span>,
1011:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L*'</span>),
1012:       <span class="ruby-value">0</span>,
1013:       <span class="ruby-constant">INFINITE</span>
1014:     )
1015:       
1016:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">wait</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">WAIT_OBJECT_0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">wait</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">WAIT_OBJECT_0</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
1017:       <span class="ruby-identifier">index</span> = <span class="ruby-identifier">wait</span> <span class="ruby-operator">-</span> <span class="ruby-constant">WAIT_OBJECT_0</span>         
1018:       <span class="ruby-identifier">handle</span> = <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">index</span>]
1019:         
1020:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
1021:         <span class="ruby-identifier">pid</span> = <span class="ruby-constant">GetProcessId</span>(<span class="ruby-identifier">handle</span>)
1022:       <span class="ruby-keyword kw">else</span>
1023:         <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">pids</span>[<span class="ruby-identifier">index</span>]
1024:       <span class="ruby-keyword kw">end</span>
1025:          
1026:       <span class="ruby-identifier">exit_code</span> = [<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'l'</span>)
1027: 
1028:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">GetExitCodeProcess</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">exit_code</span>)
1029:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">get_last_error</span>
1030:       <span class="ruby-keyword kw">end</span>
1031:          
1032:       <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
1033:          
1034:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">handle</span><span class="ruby-operator">|</span> <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) }
1035:       <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">exit_code</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'l'</span>).<span class="ruby-identifier">first</span>]
1036:     <span class="ruby-keyword kw">end</span>
1037:       
1038:     <span class="ruby-keyword kw">nil</span>
1039:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="waitpid-method" class="method-detail ">
				<a name="method-c-waitpid"></a>

				<div class="method-heading">
				
					<span class="method-name">waitpid</span><span
						class="method-args">(pid, flags = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Waits for the given child process to exit and returns that pid.
</p>
<p>
The <tt>flags</tt> argument is ignored at the moment. It is provided
strictly for interface compatibility.
</p>
<p>
Note that the $? (Process::Status) global variable is NOT set.  This may be
addressed in a future release.
</p>
					

					
					<div class="method-source-code"
						id="waitpid-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 455</span>
455:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">waitpid</span>(<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">flags</span> = <span class="ruby-keyword kw">nil</span>)
456:     <span class="ruby-identifier">exit_code</span> = [<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
457:     <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_ALL_ACCESS</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">pid</span>)
458:      
459:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
460:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
461:     <span class="ruby-keyword kw">end</span>
462:       
463:     <span class="ruby-comment cmt"># TODO: update the $? global variable (if/when possible)</span>
464:     <span class="ruby-identifier">status</span> = <span class="ruby-constant">WaitForSingleObject</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-constant">INFINITE</span>)
465:       
466:     <span class="ruby-keyword kw">begin</span>
467:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">GetExitCodeProcess</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">exit_code</span>)
468:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
469:       <span class="ruby-keyword kw">end</span>
470:     <span class="ruby-keyword kw">ensure</span>
471:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>)
472:     <span class="ruby-keyword kw">end</span>
473:       
474:     <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
475:       
476:     <span class="ruby-comment cmt"># TODO: update the $? global variable (if/when possible)</span>
477:     <span class="ruby-identifier">exit_code</span> = <span class="ruby-identifier">exit_code</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
478:       
479:     <span class="ruby-identifier">pid</span>
480:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="waitpid--method" class="method-detail ">
				<a name="method-c-waitpid2"></a>

				<div class="method-heading">
				
					<span class="method-name">waitpid2</span><span
						class="method-args">(pid, flags = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Waits for the given child process to exit and returns an array containing
the process id and the exit status.
</p>
<p>
The <tt>flags</tt> argument is ignored at the moment. It is provided
strictly for interface compatibility.
</p>
<p>
Note that the $? (Process::Status) global variable is NOT set. This may be
addressed in a future release if/when possible.
</p>
					

					
					<div class="method-source-code"
						id="waitpid--source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 494</span>
494:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">waitpid2</span>(<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">flags</span> = <span class="ruby-keyword kw">nil</span>)
495:     <span class="ruby-identifier">exit_code</span> = [<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
496:     <span class="ruby-identifier">handle</span>    = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_ALL_ACCESS</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">pid</span>)
497:       
498:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
499:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
500:     <span class="ruby-keyword kw">end</span>
501:       
502:     <span class="ruby-comment cmt"># TODO: update the $? global variable (if/when possible)</span>
503:     <span class="ruby-identifier">status</span> = <span class="ruby-constant">WaitForSingleObject</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-constant">INFINITE</span>)
504:     
505:     <span class="ruby-keyword kw">begin</span>
506:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">GetExitCodeProcess</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">exit_code</span>)
507:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
508:       <span class="ruby-keyword kw">end</span>
509:     <span class="ruby-keyword kw">ensure</span>
510:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>)
511:     <span class="ruby-keyword kw">end</span>
512:       
513:     <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
514:      
515:     <span class="ruby-comment cmt"># TODO: update the $? global variable (if/when possible)</span>
516:     <span class="ruby-identifier">exit_code</span> = <span class="ruby-identifier">exit_code</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
517:     
518:     [<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">exit_code</span>]
519:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	
		<div id="private-instance-method-details" class="method-section section">
			<h3 class="section-header">Private Instance Methods</h3>

		
			<div id="create-method" class="method-detail ">
				<a name="method-i-create"></a>

				<div class="method-heading">
				
					<span class="method-name">create</span><span
						class="method-args">(args)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
<a href="Process.html#method-i-create">Process.create</a>(key => value,
&#8230;) => ProcessInfo
</p>
<p>
This is a wrapper for the CreateProcess() function. It executes a process,
returning a ProcessInfo struct. It accepts a hash as an argument. There are
several primary keys:
</p>
<ul>
<li><p>
command_line     (mandatory)
</p>
</li>
<li><p>
app_name         (default: nil)
</p>
</li>
<li><p>
inherit          (default: false)
</p>
</li>
<li><p>
process_inherit  (default: false)
</p>
</li>
<li><p>
thread_inherit   (default: false)
</p>
</li>
<li><p>
creation_flags   (default: 0)
</p>
</li>
<li><p>
cwd              (default: Dir.pwd)
</p>
</li>
<li><p>
startup_info     (default: nil)
</p>
</li>
<li><p>
environment      (default: nil)
</p>
</li>
<li><p>
close_handles    (default: true)
</p>
</li>
<li><p>
with_logon       (default: nil)
</p>
</li>
<li><p>
domain           (default: nil)
</p>
</li>
<li><p>
password         (default: nil)
</p>
</li>
</ul>
<p>
Of these, the &#8216;command_line&#8217; or &#8216;app_name&#8217; must be
specified or an error is raised. Both may be set individually, but
&#8216;command_line&#8217; should be preferred if only one of them is set
because it does not (necessarily) require an explicit path or extension to
work.
</p>
<p>
The &#8216;domain&#8217; and &#8216;password&#8217; options are only
relevent in the context of &#8216;with_logon&#8217;.
</p>
<p>
The startup_info key takes a hash. Its keys are attributes that are part of
the StartupInfo struct, and are generally only meaningful for GUI or
console processes. See the documentation on CreateProcess() and the
StartupInfo struct on MSDN for more information.
</p>
<pre>
     
</pre>
<ul>
<li><p>
desktop
</p>
</li>
<li><p>
title
</p>
</li>
<li><p>
x
</p>
</li>
<li><p>
y
</p>
</li>
<li><p>
x_size
</p>
</li>
<li><p>
y_size
</p>
</li>
<li><p>
x_count_chars
</p>
</li>
<li><p>
y_count_chars
</p>
</li>
<li><p>
fill_attribute
</p>
</li>
<li><p>
sw_flags
</p>
</li>
<li><p>
startf_flags
</p>
</li>
<li><p>
stdin
</p>
</li>
<li><p>
stdout
</p>
</li>
<li><p>
stderr
</p>
</li>
</ul>
<p>
The relevant constants for &#8216;creation_flags&#8217;,
&#8216;sw_flags&#8217; and &#8216;startf_flags&#8217; are included in the
Windows::Process, Windows::Console and Windows::Window modules. These come
with the windows-pr library, a prerequisite of this library. Note that the
&#8216;stdin&#8217;, &#8216;stdout&#8217; and &#8216;stderr&#8217; options
can be either Ruby IO objects or file descriptors (i.e. a fileno). However,
StringIO objects are not currently supported.
</p>
<p>
If &#8216;stdin&#8217;, &#8216;stdout&#8217; or &#8216;stderr&#8217; are
specified, then the <tt>inherit</tt> value is automatically set to true and
the Process::STARTF_USESTDHANDLES flag is automatically OR&#8217;d to the
<tt>startf_flags</tt> value.
</p>
<p>
The ProcessInfo struct contains the following members:
</p>
<ul>
<li><p>
process_handle - The handle to the newly created process.
</p>
</li>
<li><p>
thread_handle  - The handle to the primary thread of the process.
</p>
</li>
<li><p>
process_id     - <a href="Process.html">Process</a> ID.
</p>
</li>
<li><p>
thread_id      - Thread ID.
</p>
</li>
</ul>
<p>
If the &#8216;close_handles&#8217; option is set to true (the default) then
the process_handle and the thread_handle are automatically closed for you
before the ProcessInfo struct is returned.
</p>
<p>
If the &#8216;with_logon&#8217; option is set, then the process runs the
specified executable file in the security context of the specified
credentials.
</p>
					

					
					<div class="method-source-code"
						id="create-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 708</span>
708:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>(<span class="ruby-identifier">args</span>)
709:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">kind_of?</span>(<span class="ruby-constant">Hash</span>)
710:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">'Expecting hash-style keyword arguments'</span>
711:     <span class="ruby-keyword kw">end</span>
712:       
713:     <span class="ruby-identifier">valid_keys</span> = <span class="ruby-node">%
714:       app_name command_line inherit creation_flags cwd environment
715:       startup_info thread_inherit process_inherit close_handles with_logon
716:       domain password
717:     /</span>
718: 
719:     <span class="ruby-identifier">valid_si_keys</span> = <span class="ruby-value str">%
720:       startf_flags desktop title x y x_size y_size x_count_chars
721:       y_count_chars fill_attribute sw_flags stdin stdout stderr
722:     /</span>
723: 
724:     <span class="ruby-comment cmt"># Set default values</span>
725:     <span class="ruby-identifier">hash</span> = {
726:       <span class="ruby-value str">'app_name'</span>       =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,
727:       <span class="ruby-value str">'creation_flags'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>,
728:       <span class="ruby-value str">'close_handles'</span>  =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>
729:     }
730:       
731:     <span class="ruby-comment cmt"># Validate the keys, and convert symbols and case to lowercase strings.     </span>
732:     <span class="ruby-identifier">args</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
733:       <span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
734:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">valid_keys</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>)
735:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;invalid key '#{key}'&quot;</span>
736:       <span class="ruby-keyword kw">end</span>
737:       <span class="ruby-identifier">hash</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">val</span>
738:     }
739:       
740:     <span class="ruby-identifier">si_hash</span> = {}
741:       
742:     <span class="ruby-comment cmt"># If the startup_info key is present, validate its subkeys</span>
743:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'startup_info'</span>]
744:       <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'startup_info'</span>].<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">val</span><span class="ruby-operator">|</span>
745:         <span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">downcase</span>
746:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">valid_si_keys</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">key</span>)
747:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-node">&quot;invalid startup_info key '#{key}'&quot;</span>
748:         <span class="ruby-keyword kw">end</span>
749:         <span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">key</span>] = <span class="ruby-identifier">val</span>
750:       }
751:     <span class="ruby-keyword kw">end</span>
752:       
753:     <span class="ruby-comment cmt"># The +command_line+ key is mandatory unless the +app_name+ key</span>
754:     <span class="ruby-comment cmt"># is specified.</span>
755:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'command_line'</span>]
756:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>]
757:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'command_line'</span>] = <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>]
758:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>] = <span class="ruby-keyword kw">nil</span>
759:       <span class="ruby-keyword kw">else</span>
760:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>, <span class="ruby-value str">'command_line or app_name must be specified'</span>
761:       <span class="ruby-keyword kw">end</span>
762:     <span class="ruby-keyword kw">end</span>
763:       
764:     <span class="ruby-comment cmt"># The environment string should be passed as a string of ';' separated</span>
765:     <span class="ruby-comment cmt"># paths.</span>
766:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'environment'</span>] 
767:       <span class="ruby-identifier">env</span> = <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'environment'</span>].<span class="ruby-identifier">split</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span>
768:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'with_logon'</span>]
769:         <span class="ruby-identifier">env</span> = <span class="ruby-identifier">env</span>.<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">e</span>) }
770:         <span class="ruby-identifier">env</span> = [<span class="ruby-identifier">env</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\00\\00&quot;&quot;</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'p*'</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>            
771:       <span class="ruby-keyword kw">else</span>
772:         <span class="ruby-identifier">env</span> = [<span class="ruby-identifier">env</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;\00&quot;&quot;</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'p*'</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
773:       <span class="ruby-keyword kw">end</span>
774:     <span class="ruby-keyword kw">else</span>
775:       <span class="ruby-identifier">env</span> = <span class="ruby-keyword kw">nil</span>
776:     <span class="ruby-keyword kw">end</span>
777: 
778:     <span class="ruby-identifier">startinfo</span> = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>]
779:     <span class="ruby-identifier">startinfo</span> = <span class="ruby-identifier">startinfo</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLLLLLLLLLLLSSLLLL'</span>)
780:     <span class="ruby-identifier">procinfo</span>  = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLLL'</span>)
781: 
782:     <span class="ruby-comment cmt"># Process SECURITY_ATTRIBUTE structure</span>
783:     <span class="ruby-identifier">process_security</span> = <span class="ruby-value">0</span>
784:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'process_inherit'</span>]
785:       <span class="ruby-identifier">process_security</span> = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLL'</span>)
786:       <span class="ruby-identifier">process_security</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>] = [<span class="ruby-value">12</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-comment cmt"># sizeof(SECURITY_ATTRIBUTE)</span>
787:       <span class="ruby-identifier">process_security</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>] = [<span class="ruby-value">1</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)  <span class="ruby-comment cmt"># TRUE</span>
788:     <span class="ruby-keyword kw">end</span>
789: 
790:     <span class="ruby-comment cmt"># Thread SECURITY_ATTRIBUTE structure</span>
791:     <span class="ruby-identifier">thread_security</span> = <span class="ruby-value">0</span>
792:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'thread_inherit'</span>]
793:       <span class="ruby-identifier">thread_security</span> = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLL'</span>)
794:       <span class="ruby-identifier">thread_security</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>] = [<span class="ruby-value">12</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-comment cmt"># sizeof(SECURITY_ATTRIBUTE)</span>
795:       <span class="ruby-identifier">thread_security</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>] = [<span class="ruby-value">1</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)  <span class="ruby-comment cmt"># TRUE</span>
796:     <span class="ruby-keyword kw">end</span>
797: 
798:     <span class="ruby-comment cmt"># Automatically handle stdin, stdout and stderr as either IO objects</span>
799:     <span class="ruby-comment cmt"># or file descriptors.  This won't work for StringIO, however.</span>
800:     [<span class="ruby-value str">'stdin'</span>, <span class="ruby-value str">'stdout'</span>, <span class="ruby-value str">'stderr'</span>].<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
801:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">io</span>]
802:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">io</span>].<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:fileno</span>)
803:           <span class="ruby-identifier">handle</span> = <span class="ruby-identifier">get_osfhandle</span>(<span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">io</span>].<span class="ruby-identifier">fileno</span>)
804:         <span class="ruby-keyword kw">else</span>
805:           <span class="ruby-identifier">handle</span> = <span class="ruby-identifier">get_osfhandle</span>(<span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">io</span>])
806:         <span class="ruby-keyword kw">end</span>
807:             
808:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
809:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
810:         <span class="ruby-keyword kw">end</span>
811: 
812:         <span class="ruby-comment cmt"># Most implementations of Ruby on Windows create inheritable</span>
813:         <span class="ruby-comment cmt"># handles by default, but some do not. RF bug #26988.</span>
814:         <span class="ruby-identifier">bool</span> = <span class="ruby-constant">SetHandleInformation</span>(
815:           <span class="ruby-identifier">handle</span>,
816:           <span class="ruby-constant">HANDLE_FLAG_INHERIT</span>,
817:           <span class="ruby-constant">HANDLE_FLAG_INHERIT</span>
818:         )
819: 
820:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bool</span>
821:             
822:         <span class="ruby-identifier">si_hash</span>[<span class="ruby-identifier">io</span>] = <span class="ruby-identifier">handle</span>
823:         <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'startf_flags'</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
824:         <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'startf_flags'</span>] <span class="ruby-operator">|=</span> <span class="ruby-constant">STARTF_USESTDHANDLES</span>
825:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'inherit'</span>] = <span class="ruby-keyword kw">true</span>
826:       <span class="ruby-keyword kw">end</span>
827:     }
828:       
829:     <span class="ruby-comment cmt"># The bytes not covered here are reserved (null)</span>
830:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">si_hash</span>.<span class="ruby-identifier">empty?</span>
831:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>]  = [<span class="ruby-identifier">startinfo</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
832:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>]  = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'desktop'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'p*'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'desktop'</span>]
833:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">12</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'title'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'p*'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'title'</span>]
834:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x'</span>]
835:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">20</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y'</span>]
836:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">24</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x_size'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x_size'</span>]
837:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">28</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y_size'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y_size'</span>]
838:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">32</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x_count_chars'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'x_count_chars'</span>]
839:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">36</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y_count_chars'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'y_count_chars'</span>]
840:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">40</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'fill_attribute'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'fill_attribute'</span>]
841:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">44</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'startf_flags'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'startf_flags'</span>]
842:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">48</span>,<span class="ruby-value">2</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'sw_flags'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'S'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'sw_flags'</span>]
843:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">56</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stdin'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stdin'</span>]
844:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">60</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stdout'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stdout'</span>]
845:       <span class="ruby-identifier">startinfo</span>[<span class="ruby-value">64</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stderr'</span>]].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">si_hash</span>[<span class="ruby-value str">'stderr'</span>]        
846:     <span class="ruby-keyword kw">end</span>
847: 
848:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'with_logon'</span>]
849:       <span class="ruby-identifier">logon</span>  = <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'with_logon'</span>])
850:       <span class="ruby-identifier">domain</span> = <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'domain'</span>])
851:       <span class="ruby-identifier">app</span>    = <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>])
852:       <span class="ruby-identifier">cmd</span>    = <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'command_line'</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'command_line'</span>])
853:       <span class="ruby-identifier">cwd</span>    = <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'cwd'</span>])
854:       <span class="ruby-identifier">passwd</span> = <span class="ruby-identifier">multi_to_wide</span>(<span class="ruby-identifier">hash</span>[<span class="ruby-value str">'password'</span>])
855:          
856:       <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'creation_flags'</span>] <span class="ruby-operator">|=</span> <span class="ruby-constant">CREATE_UNICODE_ENVIRONMENT</span>
857: 
858:       <span class="ruby-identifier">bool</span> = <span class="ruby-constant">CreateProcessWithLogonW</span>(
859:         <span class="ruby-identifier">logon</span>,                  <span class="ruby-comment cmt"># User</span>
860:         <span class="ruby-identifier">domain</span>,                 <span class="ruby-comment cmt"># Domain</span>
861:         <span class="ruby-identifier">passwd</span>,                 <span class="ruby-comment cmt"># Password</span>
862:         <span class="ruby-constant">LOGON_WITH_PROFILE</span>,     <span class="ruby-comment cmt"># Logon flags</span>
863:         <span class="ruby-identifier">app</span>,                    <span class="ruby-comment cmt"># App name</span>
864:         <span class="ruby-identifier">cmd</span>,                    <span class="ruby-comment cmt"># Command line</span>
865:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'creation_flags'</span>], <span class="ruby-comment cmt"># Creation flags</span>
866:         <span class="ruby-identifier">env</span>,                    <span class="ruby-comment cmt"># Environment</span>
867:         <span class="ruby-identifier">cwd</span>,                    <span class="ruby-comment cmt"># Working directory</span>
868:         <span class="ruby-identifier">startinfo</span>,              <span class="ruby-comment cmt"># Startup Info</span>
869:         <span class="ruby-identifier">procinfo</span>                <span class="ruby-comment cmt"># Process Info</span>
870:       )
871:     <span class="ruby-keyword kw">else</span>     
872:       <span class="ruby-identifier">bool</span> = <span class="ruby-constant">CreateProcess</span>(
873:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'app_name'</span>],       <span class="ruby-comment cmt"># App name</span>
874:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'command_line'</span>],   <span class="ruby-comment cmt"># Command line</span>
875:         <span class="ruby-identifier">process_security</span>,       <span class="ruby-comment cmt"># Process attributes</span>
876:         <span class="ruby-identifier">thread_security</span>,        <span class="ruby-comment cmt"># Thread attributes</span>
877:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'inherit'</span>],        <span class="ruby-comment cmt"># Inherit handles?</span>
878:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'creation_flags'</span>], <span class="ruby-comment cmt"># Creation flags</span>
879:         <span class="ruby-identifier">env</span>,                    <span class="ruby-comment cmt"># Environment</span>
880:         <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'cwd'</span>],            <span class="ruby-comment cmt"># Working directory</span>
881:         <span class="ruby-identifier">startinfo</span>,              <span class="ruby-comment cmt"># Startup Info</span>
882:         <span class="ruby-identifier">procinfo</span>                <span class="ruby-comment cmt"># Process Info</span>
883:       )
884:     <span class="ruby-keyword kw">end</span>      
885:       
886:     <span class="ruby-comment cmt"># TODO: Close stdin, stdout and stderr handles in the si_hash unless</span>
887:     <span class="ruby-comment cmt"># they're pointing to one of the standard handles already. [Maybe]</span>
888:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bool</span>
889:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;CreateProcess() failed: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">get_last_error</span>
890:     <span class="ruby-keyword kw">end</span>
891:       
892:     <span class="ruby-comment cmt"># Automatically close the process and thread handles in the</span>
893:     <span class="ruby-comment cmt"># PROCESS_INFORMATION struct unless explicitly told not to.</span>
894:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hash</span>[<span class="ruby-value str">'close_handles'</span>]
895:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">procinfo</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>)
896:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">procinfo</span>[<span class="ruby-value">4</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>)
897:     <span class="ruby-keyword kw">end</span>      
898:       
899:     <span class="ruby-constant">ProcessInfo</span>.<span class="ruby-identifier">new</span>(
900:       <span class="ruby-identifier">procinfo</span>[<span class="ruby-value">0</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>, <span class="ruby-comment cmt"># hProcess</span>
901:       <span class="ruby-identifier">procinfo</span>[<span class="ruby-value">4</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>, <span class="ruby-comment cmt"># hThread</span>
902:       <span class="ruby-identifier">procinfo</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>, <span class="ruby-comment cmt"># hProcessId</span>
903:       <span class="ruby-identifier">procinfo</span>[<span class="ruby-value">12</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span> <span class="ruby-comment cmt"># hThreadId</span>
904:     )
905:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="fork-method" class="method-detail ">
				<a name="method-i-fork"></a>

				<div class="method-heading">
				
					<span class="method-name">fork</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Creates the equivalent of a subshell via the CreateProcess() function. This
behaves in a manner that is similar, but not identical to, the <a
href="Kernel.html#method-i-fork">Kernel.fork</a> method for Unix. Unlike
the Unix fork, this method starts from the top of the script rather than
the point of the call.
</p>
<p>
WARNING: This implementation should be considered experimental. It is not
recommended for production use.
</p>
					

					
					<div class="method-source-code"
						id="fork-source">
<pre>
      <span class="ruby-comment cmt"># File lib/win32/process.rb, line 1086</span>
1086:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">fork</span>
1087:     <span class="ruby-identifier">last_arg</span> = <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">last</span>
1088:       
1089:     <span class="ruby-comment cmt"># Look for the 'child#xxx' tag</span>
1090:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last_arg</span> <span class="ruby-operator">=~</span> <span class="ruby-node">/child#\d+/</span>
1091:       <span class="ruby-ivar">@i</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
1092:       <span class="ruby-identifier">num</span> = <span class="ruby-identifier">last_arg</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'#'</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">to_i</span>
1093:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">num</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@i</span>
1094:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
1095:           <span class="ruby-identifier">status</span> = <span class="ruby-value">0</span>
1096:           <span class="ruby-keyword kw">begin</span>
1097:             <span class="ruby-keyword kw">yield</span>
1098:           <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Exception</span>
1099:             <span class="ruby-identifier">status</span> = <span class="ruby-value">1</span> <span class="ruby-comment cmt"># Any non-zero result is failure</span>
1100:           <span class="ruby-keyword kw">ensure</span>
1101:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">status</span>
1102:           <span class="ruby-keyword kw">end</span>
1103:         <span class="ruby-keyword kw">end</span>
1104:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
1105:       <span class="ruby-keyword kw">else</span>
1106:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
1107:       <span class="ruby-keyword kw">end</span>
1108:     <span class="ruby-keyword kw">end</span>
1109:    
1110:     <span class="ruby-comment cmt"># Tag the command with the word 'child#xxx' to distinguish it</span>
1111:     <span class="ruby-comment cmt"># from the calling process.</span>
1112:     <span class="ruby-identifier">cmd</span> = <span class="ruby-value str">'ruby -I &quot;'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">PATH_SEPARATOR</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&quot; &quot;'</span>
1113:     <span class="ruby-identifier">cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">$PROGRAM_NAME</span>) <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&quot; '</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
1114:     <span class="ruby-identifier">cmd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' child#'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">to_s</span>
1115:       
1116:     <span class="ruby-identifier">startinfo</span> = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>]
1117:     <span class="ruby-identifier">startinfo</span> = <span class="ruby-identifier">startinfo</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLLLLLLLLLLLSSLLLL'</span>)
1118:     <span class="ruby-identifier">procinfo</span>  = [<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>,<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'LLLL'</span>)
1119:       
1120:     <span class="ruby-identifier">rv</span> = <span class="ruby-constant">CreateProcess</span>(<span class="ruby-value">0</span>, <span class="ruby-identifier">cmd</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">1</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">startinfo</span>, <span class="ruby-identifier">procinfo</span>)
1121:       
1122:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rv</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
1123:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
1124:     <span class="ruby-keyword kw">end</span>
1125:       
1126:     <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">procinfo</span>[<span class="ruby-value">8</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
1127:     <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
1128:       
1129:     <span class="ruby-identifier">pid</span> 
1130:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="get-affinity-method" class="method-detail ">
				<a name="method-i-get_affinity"></a>

				<div class="method-heading">
				
					<span class="method-name">get_affinity</span><span
						class="method-args">(int = Process.pid)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns the process and system affinity mask for the given <tt>pid</tt>, or
the current process if no pid is provided. The return value is a two
element array, with the first containing the process affinity mask, and the
second containing the system affinity mask. Both are decimal values.
</p>
<p>
A process affinity mask is a bit vector indicating the processors that a
process is allowed to run on. A system affinity mask is a bit vector in
which each bit represents the processors that are configured into a system.
</p>
<p>
Example:
</p>
<pre>
   # System has 4 processors, current process is allowed to run on all
   Process.get_affinity # =&gt; [[15], [15]]

   # System has 4 processors, current process only allowed on 1 and 4 only
   Process.get_affinity # =&gt; [[9], [15]]
</pre>
<p>
If you want to convert a decimal bit vector into an array of 0&#8217;s and
1&#8217;s indicating the flag value of each processor, you can use
something like this approach:
</p>
<pre>
   mask = Process.get_affinity.first
   (0..mask).to_a.map{ |n| mask[n] }</pre>
					

					
					<div class="method-source-code"
						id="get-affinity-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 106</span>
106:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_affinity</span>(<span class="ruby-identifier">int</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>)
107:     <span class="ruby-identifier">pmask</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
108:     <span class="ruby-identifier">smask</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
109: 
110:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">int</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>
111:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">GetProcessAffinityMask</span>(<span class="ruby-constant">GetCurrentProcess</span>(), <span class="ruby-identifier">pmask</span>, <span class="ruby-identifier">smask</span>)
112:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
113:       <span class="ruby-keyword kw">end</span>
114:     <span class="ruby-keyword kw">else</span>
115:       <span class="ruby-keyword kw">begin</span>
116:         <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_QUERY_INFORMATION</span>, <span class="ruby-value">0</span> , <span class="ruby-identifier">int</span>)
117: 
118:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
119:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
120:         <span class="ruby-keyword kw">end</span>
121: 
122:         <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">GetProcessAffinityMask</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">pmask</span>, <span class="ruby-identifier">smask</span>)
123:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
124:         <span class="ruby-keyword kw">end</span>
125:       <span class="ruby-keyword kw">ensure</span>
126:         <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
127:       <span class="ruby-keyword kw">end</span>
128:     <span class="ruby-keyword kw">end</span>
129: 
130:     <span class="ruby-identifier">pmask</span> = <span class="ruby-identifier">pmask</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
131:     <span class="ruby-identifier">smask</span> = <span class="ruby-identifier">smask</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
132: 
133:     [<span class="ruby-identifier">pmask</span>, <span class="ruby-identifier">smask</span>]
134:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="getpriority-method" class="method-detail ">
				<a name="method-i-getpriority"></a>

				<div class="method-heading">
				
					<span class="method-name">getpriority</span><span
						class="method-args">(kind, int)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Retrieves the priority class for the specified process id <tt>int</tt>.
Unlike the default implementation, lower return values do not necessarily
correspond to higher priority classes.
</p>
<p>
The <tt>kind</tt> parameter is ignored but required for API compatibility.
You can only retrieve process information, not process group or user
information, so it is effectively always Process::PRIO_PROCESS.
</p>
<p>
Possible return values are:
</p>
<p>
32    - Process::NORMAL_PRIORITY_CLASS 64    - Process::IDLE_PRIORITY_CLASS
128   - Process::HIGH_PRIORITY_CLASS 256   -
Process::REALTIME_PRIORITY_CLASS 16384 -
Process::BELOW_NORMAL_PRIORITY_CLASS 32768 -
Process::ABOVE_NORMAL_PRIORITY_CLASS
</p>
					

					
					<div class="method-source-code"
						id="getpriority-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 332</span>
332:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getpriority</span>(<span class="ruby-identifier">kind</span>, <span class="ruby-identifier">int</span>)
333:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">kind</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
334:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">int</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
335: 
336:     <span class="ruby-identifier">int</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">int</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># Match spec</span>
337: 
338:     <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_QUERY_INFORMATION</span>, <span class="ruby-value">0</span> , <span class="ruby-identifier">int</span>)
339: 
340:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
341:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
342:     <span class="ruby-keyword kw">end</span>
343: 
344:     <span class="ruby-keyword kw">begin</span>
345:       <span class="ruby-identifier">priority_class</span> = <span class="ruby-constant">GetPriorityClass</span>(<span class="ruby-identifier">handle</span>)
346: 
347:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">priority_class</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
348:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
349:       <span class="ruby-keyword kw">end</span>
350:     <span class="ruby-keyword kw">ensure</span>
351:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>)
352:     <span class="ruby-keyword kw">end</span>
353: 
354:     <span class="ruby-identifier">priority_class</span>
355:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="getrlimit-method" class="method-detail ">
				<a name="method-i-getrlimit"></a>

				<div class="method-heading">
				
					<span class="method-name">getrlimit</span><span
						class="method-args">(resource)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Gets the resource limit of the current process. Only a limited number of
flags are supported.
</p>
<p>
Process::RLIMIT_CPU Process::RLIMIT_FSIZE Process::RLIMIT_AS
Process::RLIMIT_RSS Process::RLIMIT_VMEM
</p>
<p>
The Process:RLIMIT_AS, Process::RLIMIT_RSS and Process::VMEM constants all
refer to the <a href="Process.html">Process</a> memory limit. The
Process::RLIMIT_CPU constant refers to the per process user time limit. The
Process::RLIMIT_FSIZE constant is hard coded to the maximum file size on an
NTFS filesystem, approximately 4TB (or 4GB if not NTFS).
</p>
<p>
While a two element array is returned in order to comply with the spec,
there is no separate hard and soft limit. The values will always be the
same.
</p>
<p>
If [0,0] is returned then it means no limit has been set.
</p>
<p>
Example:
</p>
<pre>
  Process.getrlimit(Process::RLIMIT_VMEM) # =&gt; [0, 0]</pre>
					

					
					<div class="method-source-code"
						id="getrlimit-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 175</span>
175:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">getrlimit</span>(<span class="ruby-identifier">resource</span>)
176:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">resource</span> <span class="ruby-operator">==</span> <span class="ruby-constant">RLIMIT_FSIZE</span>
177:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">get_volume_type</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'NTFS'</span>
178:         <span class="ruby-keyword kw">return</span> ((<span class="ruby-value">1024</span><span class="ruby-operator">**</span><span class="ruby-value">4</span>) * <span class="ruby-value">4</span>) <span class="ruby-operator">-</span> (<span class="ruby-value">1024</span> * <span class="ruby-value">64</span>) <span class="ruby-comment cmt"># ~4 TB</span>
179:       <span class="ruby-keyword kw">else</span>
180:         <span class="ruby-keyword kw">return</span> (<span class="ruby-value">1024</span><span class="ruby-operator">**</span><span class="ruby-value">3</span>) * <span class="ruby-value">4</span> <span class="ruby-comment cmt"># 4 GB</span>
181:       <span class="ruby-keyword kw">end</span>
182:     <span class="ruby-keyword kw">end</span>
183: 
184:     <span class="ruby-identifier">handle</span> = <span class="ruby-keyword kw">nil</span>
185:     <span class="ruby-identifier">in_job</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">job?</span>
186: 
187:     <span class="ruby-comment cmt"># Put the current process in a job if it's not already in one</span>
188:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_job</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@job_name</span>)
189:       <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenJobObject</span>(<span class="ruby-constant">JOB_OBJECT_QUERY</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-ivar">@job_name</span>)
190:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
191:     <span class="ruby-keyword kw">else</span>
192:       <span class="ruby-ivar">@job_name</span> = <span class="ruby-value str">'ruby_'</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>.<span class="ruby-identifier">to_s</span>
193:       <span class="ruby-identifier">handle</span> = <span class="ruby-constant">CreateJobObject</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-ivar">@job_name</span>)
194:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
195:     <span class="ruby-keyword kw">end</span>
196: 
197:     <span class="ruby-keyword kw">begin</span>
198:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">in_job</span>
199:         <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">AssignProcessToJobObject</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-constant">GetCurrentProcess</span>())
200:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
201:         <span class="ruby-keyword kw">end</span>
202:       <span class="ruby-keyword kw">end</span>
203: 
204:       <span class="ruby-identifier">buf</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">112</span> <span class="ruby-comment cmt"># sizeof(struct JOBJECT_EXTENDED_LIMIT_INFORMATION)</span>
205:       <span class="ruby-identifier">val</span> = <span class="ruby-keyword kw">nil</span>         <span class="ruby-comment cmt"># value returned at end of method</span>
206: 
207:       <span class="ruby-comment cmt"># Set the LimitFlags member of the struct</span>
208:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">resource</span>
209:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RLIMIT_CPU</span>
210:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>] = [<span class="ruby-constant">JOB_OBJECT_LIMIT_PROCESS_TIME</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
211:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RLIMIT_AS</span>, <span class="ruby-constant">RLIMIT_VMEM</span>, <span class="ruby-constant">RLIMIT_RSS</span>
212:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>] = [<span class="ruby-constant">JOB_OBJECT_LIMIT_PROCESS_MEMORY</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
213:         <span class="ruby-keyword kw">else</span>
214:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;unsupported resource type&quot;</span>
215:       <span class="ruby-keyword kw">end</span>
216: 
217:       <span class="ruby-identifier">bool</span> = <span class="ruby-constant">QueryInformationJobObject</span>(
218:         <span class="ruby-identifier">handle</span>,
219:         <span class="ruby-constant">JobObjectExtendedLimitInformation</span>,
220:         <span class="ruby-identifier">buf</span>,
221:         <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">size</span>,
222:         <span class="ruby-keyword kw">nil</span>
223:       )
224: 
225:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bool</span>
226:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
227:       <span class="ruby-keyword kw">end</span>
228: 
229:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">resource</span>
230:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Process</span><span class="ruby-operator">::</span><span class="ruby-constant">RLIMIT_CPU</span>
231:           <span class="ruby-identifier">val</span> = <span class="ruby-identifier">buf</span>[<span class="ruby-value">0</span>,<span class="ruby-value">8</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'Q'</span>).<span class="ruby-identifier">first</span>
232:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RLIMIT_AS</span>, <span class="ruby-constant">RLIMIT_VMEM</span>, <span class="ruby-constant">RLIMIT_RSS</span>
233:           <span class="ruby-identifier">val</span> = <span class="ruby-identifier">buf</span>[<span class="ruby-value">96</span>,<span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
234:       <span class="ruby-keyword kw">end</span>
235:     <span class="ruby-keyword kw">ensure</span>
236:       <span class="ruby-identifier">at_exit</span>{ <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> }
237:     <span class="ruby-keyword kw">end</span>
238: 
239:     [<span class="ruby-identifier">val</span>, <span class="ruby-identifier">val</span>] <span class="ruby-comment cmt"># Return an array of two values to comply with spec</span>
240:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="job--method" class="method-detail ">
				<a name="method-i-job%3F"></a>

				<div class="method-heading">
				
					<span class="method-name">job?</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns whether or not the current process is part of a Job.
</p>
					

					
					<div class="method-source-code"
						id="job--source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 138</span>
138:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">job?</span>
139:     <span class="ruby-identifier">pbool</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
140:     <span class="ruby-constant">IsProcessInJob</span>(<span class="ruby-constant">GetCurrentProcess</span>(), <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">pbool</span>)
141:     <span class="ruby-identifier">pbool</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-keyword kw">false</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">true</span>
142:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="kill-method" class="method-detail ">
				<a name="method-i-kill"></a>

				<div class="method-heading">
				
					<span class="method-name">kill</span><span
						class="method-args">(signal, *pids)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Sends the given <tt>signal</tt> to an array of process id&#8217;s. The
<tt>signal</tt> may be any value from 0 to 9, or the special strings
&#8216;SIGINT&#8217; (or &#8216;INT&#8217;), &#8216;SIGBRK&#8217; (or
&#8216;BRK&#8217;) and &#8216;SIGKILL&#8217; (or &#8216;KILL&#8217;). An
array of successfully killed pids is returned.
</p>
<p>
Signal 0 merely tests if the process is running without killing it. Signal
2 sends a CTRL_C_EVENT to the process. Signal 3 sends a CTRL_BRK_EVENT to
the process. Signal 9 kills the process in a harsh manner. Signals 1 and
4-8 kill the process in a nice manner.
</p>
<p>
SIGINT/INT corresponds to signal 2 SIGBRK/BRK corresponds to signal 3
SIGKILL/KILL corresponds to signal 9
</p>
<p>
Signals 2 and 3 only affect console processes, and then only if the process
was created with the CREATE_NEW_PROCESS_GROUP flag.
</p>
					

					
					<div class="method-source-code"
						id="kill-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 539</span>
539:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">kill</span>(<span class="ruby-identifier">signal</span>, *<span class="ruby-identifier">pids</span>)
540:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">signal</span>
541:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'SIGINT'</span>, <span class="ruby-value str">'INT'</span>
542:         <span class="ruby-identifier">signal</span> = <span class="ruby-value">2</span>
543:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'SIGBRK'</span>, <span class="ruby-value str">'BRK'</span>
544:         <span class="ruby-identifier">signal</span> = <span class="ruby-value">3</span>
545:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'SIGKILL'</span>, <span class="ruby-value str">'KILL'</span>
546:         <span class="ruby-identifier">signal</span> = <span class="ruby-value">9</span>
547:       <span class="ruby-keyword kw">when</span> <span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">9</span>
548:         <span class="ruby-comment cmt"># Do nothing</span>
549:       <span class="ruby-keyword kw">else</span>
550:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-node">&quot;Invalid signal '#{signal}'&quot;</span>
551:     <span class="ruby-keyword kw">end</span>
552:       
553:     <span class="ruby-identifier">killed_pids</span> = []
554:       
555:     <span class="ruby-identifier">pids</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pid</span><span class="ruby-operator">|</span>
556:       <span class="ruby-comment cmt"># Send the signal to the current process if the pid is zero</span>
557:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
558:         <span class="ruby-identifier">pid</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>
559:       <span class="ruby-keyword kw">end</span>
560:        
561:       <span class="ruby-comment cmt"># No need for full access if the signal is zero</span>
562:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">signal</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
563:         <span class="ruby-identifier">access</span> = <span class="ruby-constant">PROCESS_QUERY_INFORMATION</span> <span class="ruby-operator">|</span> <span class="ruby-constant">PROCESS_VM_READ</span>
564:         <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-identifier">access</span>, <span class="ruby-value">0</span> , <span class="ruby-identifier">pid</span>)
565:       <span class="ruby-keyword kw">else</span>
566:         <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_ALL_ACCESS</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">pid</span>)
567:       <span class="ruby-keyword kw">end</span>
568:          
569:       <span class="ruby-keyword kw">begin</span>
570:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">signal</span>
571:           <span class="ruby-keyword kw">when</span> <span class="ruby-value">0</span>   
572:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
573:               <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
574:             <span class="ruby-keyword kw">else</span>
575:               <span class="ruby-comment cmt"># If ERROR_ACCESS_DENIED is returned, we know it's running</span>
576:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">GetLastError</span>() <span class="ruby-operator">==</span> <span class="ruby-constant">ERROR_ACCESS_DENIED</span>
577:                 <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
578:               <span class="ruby-keyword kw">else</span>
579:                 <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
580:               <span class="ruby-keyword kw">end</span>
581:             <span class="ruby-keyword kw">end</span>
582:           <span class="ruby-keyword kw">when</span> <span class="ruby-value">2</span>
583:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">GenerateConsoleCtrlEvent</span>(<span class="ruby-constant">CTRL_C_EVENT</span>, <span class="ruby-identifier">pid</span>)
584:               <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
585:             <span class="ruby-keyword kw">end</span>
586:           <span class="ruby-keyword kw">when</span> <span class="ruby-value">3</span>
587:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">GenerateConsoleCtrlEvent</span>(<span class="ruby-constant">CTRL_BREAK_EVENT</span>, <span class="ruby-identifier">pid</span>)
588:               <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
589:             <span class="ruby-keyword kw">end</span>
590:           <span class="ruby-keyword kw">when</span> <span class="ruby-value">9</span>
591:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TerminateProcess</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">pid</span>)
592:               <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
593:               <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)           
594:             <span class="ruby-keyword kw">else</span>
595:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
596:             <span class="ruby-keyword kw">end</span>
597:           <span class="ruby-keyword kw">else</span>
598:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
599:               <span class="ruby-identifier">thread_id</span> = [<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
600:               <span class="ruby-keyword kw">begin</span> 
601:                 <span class="ruby-identifier">thread</span> = <span class="ruby-constant">CreateRemoteThread</span>(
602:                   <span class="ruby-identifier">handle</span>,
603:                   <span class="ruby-value">0</span>,
604:                   <span class="ruby-value">0</span>,
605:                   <span class="ruby-constant">GetProcAddress</span>(<span class="ruby-constant">GetModuleHandle</span>(<span class="ruby-value str">'kernel32'</span>), <span class="ruby-value str">'ExitProcess'</span>),
606:                   <span class="ruby-value">0</span>,
607:                   <span class="ruby-value">0</span>,
608:                   <span class="ruby-identifier">thread_id</span>
609:                 )
610: 
611:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">thread</span>
612:                   <span class="ruby-constant">WaitForSingleObject</span>(<span class="ruby-identifier">thread</span>, <span class="ruby-value">5</span>)
613:                   <span class="ruby-identifier">killed_pids</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">pid</span>)
614:                   <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
615:                 <span class="ruby-keyword kw">else</span>
616:                   <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
617:                 <span class="ruby-keyword kw">end</span>
618:               <span class="ruby-keyword kw">ensure</span>
619:                 <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">thread</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">thread</span>
620:               <span class="ruby-keyword kw">end</span>
621:             <span class="ruby-keyword kw">else</span>
622:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
623:           <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># case</span>
624: 
625:           <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
626:         <span class="ruby-keyword kw">end</span>
627:       <span class="ruby-keyword kw">ensure</span>
628:         <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
629:       <span class="ruby-keyword kw">end</span>
630:     }
631:       
632:     <span class="ruby-identifier">killed_pids</span>
633:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="ppid-method" class="method-detail ">
				<a name="method-i-ppid"></a>

				<div class="method-heading">
				
					<span class="method-name">ppid</span><span
						class="method-args">()</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns the process ID of the parent of this process.
</p>
					

					
					<div class="method-source-code"
						id="ppid-source">
<pre>
      <span class="ruby-comment cmt"># File lib/win32/process.rb, line 1045</span>
1045:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ppid</span>
1046:     <span class="ruby-identifier">ppid</span> = <span class="ruby-value">0</span>
1047: 
1048:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ppid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># Paranoia</span>
1049: 
1050:     <span class="ruby-identifier">handle</span> = <span class="ruby-constant">CreateToolhelp32Snapshot</span>(<span class="ruby-constant">TH32CS_SNAPPROCESS</span>, <span class="ruby-value">0</span>)
1051: 
1052:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
1053:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
1054:     <span class="ruby-keyword kw">end</span>
1055: 
1056:     <span class="ruby-identifier">proc_entry</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">296</span> <span class="ruby-comment cmt"># 36 + 260</span>
1057:     <span class="ruby-identifier">proc_entry</span>[<span class="ruby-value">0</span>, <span class="ruby-value">4</span>] = [<span class="ruby-identifier">proc_entry</span>.<span class="ruby-identifier">size</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-comment cmt"># Set dwSize member</span>
1058:       
1059:     <span class="ruby-keyword kw">begin</span>             
1060:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">Process32First</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">proc_entry</span>)
1061:         <span class="ruby-identifier">error</span> = <span class="ruby-identifier">get_last_error</span>
1062:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">error</span>
1063:       <span class="ruby-keyword kw">end</span>
1064: 
1065:       <span class="ruby-keyword kw">while</span> <span class="ruby-constant">Process32Next</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">proc_entry</span>)
1066:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">proc_entry</span>[<span class="ruby-value">8</span>, <span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>)[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>
1067:           <span class="ruby-identifier">ppid</span> = <span class="ruby-identifier">proc_entry</span>[<span class="ruby-value">24</span>, <span class="ruby-value">4</span>].<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>)[<span class="ruby-value">0</span>] <span class="ruby-comment cmt"># th32ParentProcessID</span>
1068:           <span class="ruby-keyword kw">break</span>
1069:         <span class="ruby-keyword kw">end</span>
1070:       <span class="ruby-keyword kw">end</span>
1071:     <span class="ruby-keyword kw">ensure</span>
1072:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>)
1073:     <span class="ruby-keyword kw">end</span>
1074: 
1075:     <span class="ruby-identifier">ppid</span>
1076:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="setpriority-method" class="method-detail ">
				<a name="method-i-setpriority"></a>

				<div class="method-heading">
				
					<span class="method-name">setpriority</span><span
						class="method-args">(kind, int, int_priority)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Sets the priority class for the specified process id <tt>int</tt>.
</p>
<p>
The <tt>kind</tt> parameter is ignored but present for API compatibility.
You can only retrieve process information, not process group or user
information, so it is effectively always Process::PRIO_PROCESS.
</p>
<p>
Possible <tt>int_priority</tt> values are:
</p>
<ul>
<li><p>
Process::NORMAL_PRIORITY_CLASS
</p>
</li>
<li><p>
Process::IDLE_PRIORITY_CLASS
</p>
</li>
<li><p>
Process::HIGH_PRIORITY_CLASS
</p>
</li>
<li><p>
Process::REALTIME_PRIORITY_CLASS
</p>
</li>
<li><p>
Process::BELOW_NORMAL_PRIORITY_CLASS
</p>
</li>
<li><p>
Process::ABOVE_NORMAL_PRIORITY_CLASS
</p>
</li>
</ul>
					

					
					<div class="method-source-code"
						id="setpriority-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 372</span>
372:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setpriority</span>(<span class="ruby-identifier">kind</span>, <span class="ruby-identifier">int</span>, <span class="ruby-identifier">int_priority</span>)
373:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">kind</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
374:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">int</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
375:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">int_priority</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
376: 
377:     <span class="ruby-identifier">int</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">int</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># Match spec</span>
378: 
379:     <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_SET_INFORMATION</span>, <span class="ruby-value">0</span> , <span class="ruby-identifier">int</span>)
380: 
381:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
382:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
383:     <span class="ruby-keyword kw">end</span>
384: 
385:     <span class="ruby-keyword kw">begin</span>
386:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">SetPriorityClass</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">int_priority</span>)
387:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
388:       <span class="ruby-keyword kw">end</span>
389:     <span class="ruby-keyword kw">ensure</span>
390:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>)
391:     <span class="ruby-keyword kw">end</span>
392: 
393:     <span class="ruby-keyword kw">return</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># Match the spec</span>
394:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="setrlimit-method" class="method-detail ">
				<a name="method-i-setrlimit"></a>

				<div class="method-heading">
				
					<span class="method-name">setrlimit</span><span
						class="method-args">(resource, current_limit, max_limit = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Sets the resource limit of the current process. Only a limited number of
flags are supported.
</p>
<p>
Process::RLIMIT_CPU Process::RLIMIT_AS Process::RLIMIT_RSS
Process::RLIMIT_VMEM
</p>
<p>
The Process:RLIMIT_AS, Process::RLIMIT_RSS and Process::VMEM constants all
refer to the <a href="Process.html">Process</a> memory limit. The
Process::RLIMIT_CPU constant refers to the per process user time limit.
</p>
<p>
The <tt>max_limit</tt> parameter is provided for interface compatibility
only. It is always set to the current_limit value.
</p>
<p>
Example:
</p>
<pre>
  Process.setrlimit(Process::RLIMIT_VMEM, 1024 * 4) # =&gt; nil
  Process.getrlimit(Process::RLIMIT_VMEM) # =&gt; [4096, 4096]</pre>
					

					
					<div class="method-source-code"
						id="setrlimit-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 262</span>
262:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setrlimit</span>(<span class="ruby-identifier">resource</span>, <span class="ruby-identifier">current_limit</span>, <span class="ruby-identifier">max_limit</span> = <span class="ruby-keyword kw">nil</span>)
263:     <span class="ruby-identifier">max_limit</span> = <span class="ruby-identifier">current_limit</span>
264: 
265:     <span class="ruby-identifier">handle</span> = <span class="ruby-keyword kw">nil</span>
266:     <span class="ruby-identifier">in_job</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">job?</span>
267: 
268:     <span class="ruby-comment cmt"># Put the current process in a job if it's not already in one</span>
269:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">in_job</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-ivar">@job_name</span>
270:       <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenJobObject</span>(<span class="ruby-constant">JOB_OBJECT_SET_ATTRIBUTES</span>, <span class="ruby-keyword kw">true</span>, <span class="ruby-ivar">@job_name</span>)
271:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
272:     <span class="ruby-keyword kw">else</span>
273:       <span class="ruby-ivar">@job_name</span> = <span class="ruby-value str">'ruby_'</span> <span class="ruby-operator">+</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>.<span class="ruby-identifier">to_s</span>
274:       <span class="ruby-identifier">handle</span> = <span class="ruby-constant">CreateJobObject</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">job_name</span>)
275:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
276:     <span class="ruby-keyword kw">end</span>
277: 
278:     <span class="ruby-keyword kw">begin</span>
279:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">in_job</span>
280:         <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">AssignProcessToJobObject</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-constant">GetCurrentProcess</span>())
281:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
282:         <span class="ruby-keyword kw">end</span>
283:       <span class="ruby-keyword kw">end</span>
284: 
285:       <span class="ruby-comment cmt"># sizeof(struct JOBJECT_EXTENDED_LIMIT_INFORMATION)</span>
286:       <span class="ruby-identifier">buf</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">112</span>
287: 
288:       <span class="ruby-comment cmt"># Set the LimitFlags and relevant members of the struct</span>
289:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">resource</span>
290:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RLIMIT_CPU</span>
291:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>] = [<span class="ruby-constant">JOB_OBJECT_LIMIT_PROCESS_TIME</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
292:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">0</span>,<span class="ruby-value">8</span>]  = [<span class="ruby-identifier">max_limit</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'Q'</span>) <span class="ruby-comment cmt"># PerProcessUserTimeLimit</span>
293:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">RLIMIT_AS</span>, <span class="ruby-constant">RLIMIT_VMEM</span>, <span class="ruby-constant">RLIMIT_RSS</span>
294:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">16</span>,<span class="ruby-value">4</span>] = [<span class="ruby-constant">JOB_OBJECT_LIMIT_PROCESS_MEMORY</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
295:           <span class="ruby-identifier">buf</span>[<span class="ruby-value">96</span>,<span class="ruby-value">4</span>] = [<span class="ruby-identifier">max_limit</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>) <span class="ruby-comment cmt"># ProcessMemoryLimit</span>
296:         <span class="ruby-keyword kw">else</span>
297:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-value str">&quot;unsupported resource type&quot;</span>
298:       <span class="ruby-keyword kw">end</span>
299: 
300:       <span class="ruby-identifier">bool</span> = <span class="ruby-constant">SetInformationJobObject</span>(
301:         <span class="ruby-identifier">handle</span>,
302:         <span class="ruby-constant">JobObjectExtendedLimitInformation</span>,
303:         <span class="ruby-identifier">buf</span>,
304:         <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">size</span>
305:       )
306: 
307:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bool</span>
308:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
309:       <span class="ruby-keyword kw">end</span>
310:     <span class="ruby-keyword kw">ensure</span>
311:       <span class="ruby-identifier">at_exit</span>{ <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> }
312:     <span class="ruby-keyword kw">end</span>
313:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="uid-method" class="method-detail ">
				<a name="method-i-uid"></a>

				<div class="method-heading">
				
					<span class="method-name">uid</span><span
						class="method-args">(sid = false)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Returns the uid of the current process. Specifically, it returns the RID of
the SID associated with the owner of the process.
</p>
<p>
If <tt>sid</tt> is set to true, then a binary sid is returned. Otherwise, a
numeric id is returned (the default).
</p>
					

					
					<div class="method-source-code"
						id="uid-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 404</span>
404:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">uid</span>(<span class="ruby-identifier">sid</span> = <span class="ruby-keyword kw">false</span>)
405:     <span class="ruby-identifier">token</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
406: 
407:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">sid</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">TrueClass</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">sid</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">FalseClass</span>)
408: 
409:     <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">OpenProcessToken</span>(<span class="ruby-constant">GetCurrentProcess</span>(), <span class="ruby-constant">TOKEN_QUERY</span>, <span class="ruby-identifier">token</span>)
410:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
411:     <span class="ruby-keyword kw">end</span>
412: 
413:     <span class="ruby-identifier">token</span>   = <span class="ruby-identifier">token</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'V'</span>)[<span class="ruby-value">0</span>]
414:     <span class="ruby-identifier">rlength</span> = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
415:     <span class="ruby-identifier">tuser</span>   = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">512</span>
416: 
417:     <span class="ruby-identifier">bool</span> = <span class="ruby-constant">GetTokenInformation</span>(
418:       <span class="ruby-identifier">token</span>,
419:       <span class="ruby-constant">TokenUser</span>,
420:       <span class="ruby-identifier">tuser</span>,
421:       <span class="ruby-identifier">tuser</span>.<span class="ruby-identifier">size</span>,
422:       <span class="ruby-identifier">rlength</span>
423:     )
424: 
425:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">bool</span>
426:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
427:     <span class="ruby-keyword kw">end</span>
428: 
429:     <span class="ruby-identifier">lsid</span> = <span class="ruby-identifier">tuser</span>[<span class="ruby-value">8</span>, (<span class="ruby-identifier">rlength</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">-</span> <span class="ruby-value">8</span>)]
430: 
431:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sid</span>
432:       <span class="ruby-identifier">lsid</span>
433:     <span class="ruby-keyword kw">else</span>
434:       <span class="ruby-identifier">sid_addr</span> = [<span class="ruby-identifier">lsid</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'p*'</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>)[<span class="ruby-value">0</span>]
435:       <span class="ruby-identifier">sid_buf</span>  = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">80</span>
436:       <span class="ruby-identifier">sid_ptr</span>  = <span class="ruby-value">0</span>.<span class="ruby-identifier">chr</span> * <span class="ruby-value">4</span>
437: 
438:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">ConvertSidToStringSid</span>(<span class="ruby-identifier">sid_addr</span>, <span class="ruby-identifier">sid_ptr</span>)
439:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
440:       <span class="ruby-keyword kw">end</span>
441: 
442:       <span class="ruby-identifier">strcpy</span>(<span class="ruby-identifier">sid_buf</span>, <span class="ruby-identifier">sid_ptr</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>)[<span class="ruby-value">0</span>])
443:       <span class="ruby-identifier">sid_buf</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'-'</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">to_i</span>
444:     <span class="ruby-keyword kw">end</span>
445:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="wait-method" class="method-detail ">
				<a name="method-i-wait"></a>

				<div class="method-heading">
				
					<span class="method-name">wait</span><span
						class="method-args">(pid = -1, flags = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Waits for any child process to exit and returns the process id of that
child. If a pid is provided that is greater than or equal to 0, then it is
the equivalent of calling <a
href="Process.html#method-i-waitpid">Process.waitpid</a>.
</p>
<p>
The <tt>flags</tt> argument is ignored at the moment. It is provided
strictly for interface compatibility.
</p>
<p>
Note that the $? (Process::Status) global variable is NOT set.  This may be
addressed in a future release.
</p>
					

					
					<div class="method-source-code"
						id="wait-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 920</span>
920:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wait</span>(<span class="ruby-identifier">pid</span> = <span class="ruby-value">1</span>, <span class="ruby-identifier">flags</span> = <span class="ruby-keyword kw">nil</span>)
921:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>
922:       <span class="ruby-identifier">pid</span>, <span class="ruby-identifier">status</span> = <span class="ruby-identifier">waitpid</span>(<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">flags</span>)
923:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pid</span>
924:     <span class="ruby-keyword kw">end</span>
925: 
926:     <span class="ruby-identifier">handles</span> = []
927:       
928:     <span class="ruby-comment cmt"># Windows 2000 or earlier</span>
929:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
930:       <span class="ruby-identifier">pids</span> = []
931:     <span class="ruby-keyword kw">end</span>
932:       
933:     <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">each_with_index</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pid</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
934:       <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_ALL_ACCESS</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">pid</span>)
935:        
936:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
937:         <span class="ruby-identifier">err</span> = <span class="ruby-node">&quot;unable to get HANDLE on process associated with pid #{pid}&quot;</span>
938:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">err</span>
939:       <span class="ruby-keyword kw">end</span>
940:          
941:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
942:         <span class="ruby-identifier">pids</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">pid</span>
943:       <span class="ruby-keyword kw">end</span>      
944:     }
945:     
946:     <span class="ruby-identifier">wait</span> = <span class="ruby-constant">WaitForMultipleObjects</span>(
947:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">size</span>,
948:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L*'</span>),
949:       <span class="ruby-value">0</span>,
950:       <span class="ruby-constant">INFINITE</span>
951:     )
952:       
953:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">wait</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">WAIT_OBJECT_0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">wait</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">WAIT_OBJECT_0</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
954:       <span class="ruby-identifier">index</span> = <span class="ruby-identifier">wait</span> <span class="ruby-operator">-</span> <span class="ruby-constant">WAIT_OBJECT_0</span>         
955:       <span class="ruby-identifier">handle</span> = <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">index</span>]
956:          
957:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
958:         <span class="ruby-identifier">pid</span> = <span class="ruby-constant">GetProcessId</span>(<span class="ruby-identifier">handle</span>)
959:       <span class="ruby-keyword kw">else</span>
960:         <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">pids</span>[<span class="ruby-identifier">index</span>]
961:       <span class="ruby-keyword kw">end</span>
962:          
963:       <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
964:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">handle</span><span class="ruby-operator">|</span> <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) }
965:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pid</span>
966:     <span class="ruby-keyword kw">end</span>
967:       
968:     <span class="ruby-keyword kw">nil</span>
969:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="wait--method" class="method-detail ">
				<a name="method-i-wait2"></a>

				<div class="method-heading">
				
					<span class="method-name">wait2</span><span
						class="method-args">(pid = -1, flags = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Waits for any child process to exit and returns an array containing the
process id and the exit status of that child.
</p>
<p>
The <tt>flags</tt> argument is ignored at the moment. It is provided
strictly for interface compatibility.
</p>
<p>
Note that the $? (Process::Status) global variable is NOT set.  This may be
addressed in a future release.
</p>
					

					
					<div class="method-source-code"
						id="wait--source">
<pre>
      <span class="ruby-comment cmt"># File lib/win32/process.rb, line 983</span>
 983:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wait2</span>(<span class="ruby-identifier">pid</span> = <span class="ruby-value">1</span>, <span class="ruby-identifier">flags</span> = <span class="ruby-keyword kw">nil</span>)
 984:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">pid</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span>
 985:       <span class="ruby-identifier">pid</span>, <span class="ruby-identifier">status</span> = <span class="ruby-identifier">waitpid2</span>(<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">flags</span>)
 986:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pid</span>
 987:     <span class="ruby-keyword kw">end</span>
 988: 
 989:     <span class="ruby-identifier">handles</span> = []
 990:      
 991:     <span class="ruby-comment cmt"># Windows 2000 or earlier</span>
 992:     <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
 993:       <span class="ruby-identifier">pids</span> = []
 994:     <span class="ruby-keyword kw">end</span>
 995:       
 996:     <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">each_with_index</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pid</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
 997:       <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_ALL_ACCESS</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">pid</span>)
 998:         
 999:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
1000:         <span class="ruby-identifier">err</span> = <span class="ruby-node">&quot;unable to get HANDLE on process associated with pid #{pid}&quot;</span>
1001:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">err</span>
1002:       <span class="ruby-keyword kw">end</span>
1003:         
1004:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
1005:         <span class="ruby-identifier">pids</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">pid</span>
1006:       <span class="ruby-keyword kw">end</span>      
1007:     }
1008:     
1009:     <span class="ruby-identifier">wait</span> = <span class="ruby-constant">WaitForMultipleObjects</span>(
1010:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">size</span>,
1011:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L*'</span>),
1012:       <span class="ruby-value">0</span>,
1013:       <span class="ruby-constant">INFINITE</span>
1014:     )
1015:       
1016:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">wait</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">WAIT_OBJECT_0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">wait</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">WAIT_OBJECT_0</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
1017:       <span class="ruby-identifier">index</span> = <span class="ruby-identifier">wait</span> <span class="ruby-operator">-</span> <span class="ruby-constant">WAIT_OBJECT_0</span>         
1018:       <span class="ruby-identifier">handle</span> = <span class="ruby-identifier">handles</span>[<span class="ruby-identifier">index</span>]
1019:         
1020:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">GetProcessId</span>
1021:         <span class="ruby-identifier">pid</span> = <span class="ruby-constant">GetProcessId</span>(<span class="ruby-identifier">handle</span>)
1022:       <span class="ruby-keyword kw">else</span>
1023:         <span class="ruby-identifier">pid</span> = <span class="ruby-identifier">pids</span>[<span class="ruby-identifier">index</span>]
1024:       <span class="ruby-keyword kw">end</span>
1025:          
1026:       <span class="ruby-identifier">exit_code</span> = [<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'l'</span>)
1027: 
1028:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">GetExitCodeProcess</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">exit_code</span>)
1029:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">get_last_error</span>
1030:       <span class="ruby-keyword kw">end</span>
1031:          
1032:       <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
1033:          
1034:       <span class="ruby-identifier">handles</span>.<span class="ruby-identifier">each</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">handle</span><span class="ruby-operator">|</span> <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>) }
1035:       <span class="ruby-keyword kw">return</span> [<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">exit_code</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'l'</span>).<span class="ruby-identifier">first</span>]
1036:     <span class="ruby-keyword kw">end</span>
1037:       
1038:     <span class="ruby-keyword kw">nil</span>
1039:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="waitpid-method" class="method-detail ">
				<a name="method-i-waitpid"></a>

				<div class="method-heading">
				
					<span class="method-name">waitpid</span><span
						class="method-args">(pid, flags = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Waits for the given child process to exit and returns that pid.
</p>
<p>
The <tt>flags</tt> argument is ignored at the moment. It is provided
strictly for interface compatibility.
</p>
<p>
Note that the $? (Process::Status) global variable is NOT set.  This may be
addressed in a future release.
</p>
					

					
					<div class="method-source-code"
						id="waitpid-source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 455</span>
455:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">waitpid</span>(<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">flags</span> = <span class="ruby-keyword kw">nil</span>)
456:     <span class="ruby-identifier">exit_code</span> = [<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
457:     <span class="ruby-identifier">handle</span> = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_ALL_ACCESS</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">pid</span>)
458:      
459:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
460:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
461:     <span class="ruby-keyword kw">end</span>
462:       
463:     <span class="ruby-comment cmt"># TODO: update the $? global variable (if/when possible)</span>
464:     <span class="ruby-identifier">status</span> = <span class="ruby-constant">WaitForSingleObject</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-constant">INFINITE</span>)
465:       
466:     <span class="ruby-keyword kw">begin</span>
467:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">GetExitCodeProcess</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">exit_code</span>)
468:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
469:       <span class="ruby-keyword kw">end</span>
470:     <span class="ruby-keyword kw">ensure</span>
471:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>)
472:     <span class="ruby-keyword kw">end</span>
473:       
474:     <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
475:       
476:     <span class="ruby-comment cmt"># TODO: update the $? global variable (if/when possible)</span>
477:     <span class="ruby-identifier">exit_code</span> = <span class="ruby-identifier">exit_code</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
478:       
479:     <span class="ruby-identifier">pid</span>
480:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
			<div id="waitpid--method" class="method-detail ">
				<a name="method-i-waitpid2"></a>

				<div class="method-heading">
				
					<span class="method-name">waitpid2</span><span
						class="method-args">(pid, flags = nil)</span>
					<span class="method-click-advice">click to toggle source</span>
				
				</div>

				<div class="method-description">
					
					<p>
Waits for the given child process to exit and returns an array containing
the process id and the exit status.
</p>
<p>
The <tt>flags</tt> argument is ignored at the moment. It is provided
strictly for interface compatibility.
</p>
<p>
Note that the $? (Process::Status) global variable is NOT set. This may be
addressed in a future release if/when possible.
</p>
					

					
					<div class="method-source-code"
						id="waitpid--source">
<pre>
     <span class="ruby-comment cmt"># File lib/win32/process.rb, line 494</span>
494:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">waitpid2</span>(<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">flags</span> = <span class="ruby-keyword kw">nil</span>)
495:     <span class="ruby-identifier">exit_code</span> = [<span class="ruby-value">0</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">'L'</span>)
496:     <span class="ruby-identifier">handle</span>    = <span class="ruby-constant">OpenProcess</span>(<span class="ruby-constant">PROCESS_ALL_ACCESS</span>, <span class="ruby-value">0</span>, <span class="ruby-identifier">pid</span>)
497:       
498:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handle</span> <span class="ruby-operator">==</span> <span class="ruby-constant">INVALID_HANDLE_VALUE</span>
499:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
500:     <span class="ruby-keyword kw">end</span>
501:       
502:     <span class="ruby-comment cmt"># TODO: update the $? global variable (if/when possible)</span>
503:     <span class="ruby-identifier">status</span> = <span class="ruby-constant">WaitForSingleObject</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-constant">INFINITE</span>)
504:     
505:     <span class="ruby-keyword kw">begin</span>
506:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">GetExitCodeProcess</span>(<span class="ruby-identifier">handle</span>, <span class="ruby-identifier">exit_code</span>)
507:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">Error</span>, <span class="ruby-identifier">get_last_error</span>
508:       <span class="ruby-keyword kw">end</span>
509:     <span class="ruby-keyword kw">ensure</span>
510:       <span class="ruby-constant">CloseHandle</span>(<span class="ruby-identifier">handle</span>)
511:     <span class="ruby-keyword kw">end</span>
512:       
513:     <span class="ruby-ivar">@child_pids</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">pid</span>)
514:      
515:     <span class="ruby-comment cmt"># TODO: update the $? global variable (if/when possible)</span>
516:     <span class="ruby-identifier">exit_code</span> = <span class="ruby-identifier">exit_code</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">'L'</span>).<span class="ruby-identifier">first</span>
517:     
518:     [<span class="ruby-identifier">pid</span>, <span class="ruby-identifier">exit_code</span>]
519:   <span class="ruby-keyword kw">end</span></pre>
					</div>
					
				</div>

				

				
			</div>

		
		</div>
	

	</div>


	<div id="rdoc-debugging-section-dump" class="debugging-section">
	
		<p>Disabled; run with --debug to generate this.</p>
	
	</div>

	<div id="validator-badges">
		<p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
		<p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
			Rdoc Generator</a> 1.1.6</small>.</p>
	</div>

</body>
</html>

